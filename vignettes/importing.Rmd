---
title: "import_file: Import files from oxygen probe systems"
output: 
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
vignette: >
  %\VignetteIndexEntry{import_file: Import files from oxygen probe systems}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = F}
library(knitr) # load knitr to enable options
library(respR) # load respR

opts_chunk$set(collapse = TRUE, 
               comment = "#>", 
               cache = FALSE, 
               tidy = TRUE, 
               highlight = TRUE, 
               fig.width = 6, 
               fig.height = 5,
               fig.align = "center")
```

# Introduction

`respR` was designed to be a universal, end-to-end solution for analysing data and reporting analyses from any and all aquatic respirometry experiments regardless of the equipment used. 
Therefore, it is system-agnostic; the data need only be put into a very simple structure - numeric time against oxygen in any common units in a `data.frame` - to allow a full analysis to be conducted. 
In fact the entire package, with the exception of the final conversion step in `convert_rate`, treats data as unitless so non-aquatic respirometry data or [any time-series data](https://januarharianto.github.io/respR/articles/citations.html#klementievdevelopmentversatilelowcost2022) can be explored and analysed. 

The package follows an *[object-oriented](https://en.wikipedia.org/wiki/Object-oriented_programming)* approach. Each function has been designed to output objects which can be entered into subsequent functions reducing the need for additional inputs. 
However, generic `R` data objects, including values, vectors, and objects of class `data.frame`, `data.table`, and `tibble` are also recognised by most functions.
The only structural data requirement is that the initial time\~oxygen data be in a specific structure: a column of numeric time-elapsed (in secs, mins, hours or days) and a column of oxygen amount (in any commonly used unit). 
Every respirometry system, to our knowledge, allows data to be exported in such a format, or at least in a structure from which it is easy to parse it to this format. 

Two functions are provided to assist with bringing in and formatting your data correctly. This vignette covers `import_file()`. See `vignette("format_time")` to convert date-time data to numeric time. 

# `import_file`

Most oxygen probe systems allow data to be exported in easily readable formats (e.g. csv, txt) which contain the numeric time and oxygen data `respR` requires. These files are usually easily imported into R using generic functions such as `read.csv()` and the relevant columns specified when used in `respR` functions, or extracted into separate data frames. 

Many systems however have raw output files with redundant information, or a structure that confuses importing functions. For example Loligo Systems AutoResp and Witrox files have several rows of metadata above the columns of raw data. While `read.csv()` has options to not import certain rows and columns, or the files could be edited beforehand, `respR` can import many raw data files from various systems without modification. 

`import_file()` uses pattern recognition to identify the originating system of the file, imports it, formats columns and column names, and outputs a data frame that can be passed to `respR` functions.

Note use of this function to prepare the data for use in `respR` is ***optional***. It is a convenience function and mainly intended for those new to `R`. If you are even slightly experienced in `R` you will know how to import data and structure it to a simple dataframe of time against oxygen. It is *almost always* better to import files yourself using functions such as `read.csv()`, `read.table()` or `fread()` as it gives you much more control and the ability to troubleshoot issues.

## Example

This is a screenshot of what the file we want to import looks like in Excel.

```{r, out.width = "700px", eval = T, echo = FALSE}
knitr::include_graphics("img/witrox.png")
```

We can see there are several rows of redundant information. There are also spaces and odd characters in the column names that often cause text encoding errors when imported into R, such as ` & ` and square brackets. 

`import_file` can bring in this file (situated in the current working directory, otherwise any external file can be specified with a filepath):

```{r eval = T}
data <- import_file("Witrox_eg.txt")
```

There are six columns, but we will print only the relevant date, numeric timestamp, and oxygen columns

```{r eval = T}
data[,c(1,2,6)]
```

As we can see, the function automatically recognises that this is a Witrox file, removes redundant rows, and renames the columns, removing spaces and problem characters while keeping unique identifiers. 

This function requires only a single input, the path to the file. Everything else is handled automatically. The function will even automatically recognise data formatted in the European style using commas for decimals.

## Supported systems

`import_file` supports several systems at present, including Firesting, Pyro, PreSens, MiniDOT, Loligo Witrox, Vernier and more. See `import_file()` for full list. 

Note however, some files may fail to import as expected because of structural or version differences we have not encountered. We would encourage users to [send us sample files for testing](https://januarharianto.github.io/respR/articles/contact.html), especially any they have problems with, or from systems we do not yet support. 

## Import failures

Oxygen probe system output formats are changed frequently, or may contain differences we have not been able to test for. If a file fails to import, please send it to us by opening a [Github issue](https://github.com/januarharianto/respR/issues) or via [email](mailto:nicholascarey@gmail.com). The more files we have for testing, the more robust and useful the function becomes. 

If you can't import the data via `import_file`, consider trying the following functions, which are the ones we use internally:

- `read.csv()` - Also imports `.txt` files. The `nrows` and `skip` inputs are particularly useful.

- `fread()` - In the `data.table` package. Also imports `.txt` files. Faster and more efficient than `read.csv`. Like `read.csv`, the `nrows` and `skip` inputs are particularly useful.

- `read_excel` & `read_xlsx` - in the `read_excel` package. 

- `readLines` - a powerful but crude tool that dumps the entire text content of files. Requires a lot of processing afterwards to get any useful data. A last resort option. 

# Checking output and next steps

If the imported data does not contain a numeric time or timestamp column, but only dates and times see `vignette("format_time")`. After your data is in a paired, numeric oxygen~time structure, it can be passed to `inspect()` to check the importing or time formatting has worked, look for common errors, and visualise the dataset. See `vignette("inspecting")`.


