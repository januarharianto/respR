<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>auto_rate: Automatic detection of metabolic rates • respR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="auto_rate: Automatic detection of metabolic rates">
<meta property="og:description" content="respR">
<meta property="og:image" content="https://januarharianto.github.io/respR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">respR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/respR.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">---- Complete Workflows ----</li>
    <li>
      <a href="../articles/closed.html">Closed-chamber respirometry</a>
    </li>
    <li>
      <a href="../articles/intermittent_short.html">Intermittent-flow respirometry: Short experiment</a>
    </li>
    <li>
      <a href="../articles/intermittent_long.html">Intermittent-flow respirometry: Long experiment</a>
    </li>
    <li>
      <a href="../articles/flowthrough.html">Flowthrough respirometry</a>
    </li>
    <li>
      <a href="../articles/oxycrit.html">Critical oxygen values (PCrit)</a>
    </li>
    <li>
      <a href="../articles/oxy_production.html">Oxygen production respirometry</a>
    </li>
    <li class="dropdown-header">---- Function Guides ----</li>
    <li>
      <a href="../articles/inspecting.html">inspect: Inspecting data</a>
    </li>
    <li>
      <a href="../articles/subset_data.html">subset_data: Subset data by time, row, or oxygen ranges</a>
    </li>
    <li>
      <a href="../articles/calc_rate.html">calc_rate: Manually select and calculate rates</a>
    </li>
    <li>
      <a href="../articles/calc_rate.int.html">calc_rate.int: Manual extraction of rates in intermittent-flow respirometry</a>
    </li>
    <li>
      <a href="../articles/auto_rate.html">auto_rate: Automatic detection of linear rates</a>
    </li>
    <li>
      <a href="../articles/auto_rate.int.html">auto_rate.int: Automatic extraction of rates in intermittent-flow respirometry</a>
    </li>
    <li>
      <a href="../articles/adjust_rate.html">adjust_rate: Adjusting rates for background</a>
    </li>
    <li>
      <a href="../articles/select_rate.html">select_rate: Exploring and filtering results</a>
    </li>
    <li>
      <a href="../articles/format_time.html">format_time: Convert date-time data to numeric time</a>
    </li>
    <li>
      <a href="../articles/convert_DO.html">convert_DO: Convert between units of dissolved oxygen</a>
    </li>
    <li class="dropdown-header">---- Miscellaneous ----</li>
    <li>
      <a href="../articles/importing.html">Importing files from oxygen probe systems</a>
    </li>
    <li>
      <a href="../articles/twopoint.html">Two-point rate calculation</a>
    </li>
    <li>
      <a href="../articles/subsample.html">Thin larger datasets</a>
    </li>
    <li>
      <a href="../articles/tidyverse.html">Integration with the tidyverse</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reporting reproducibile analyses</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/contact.html">Contact</a>
    </li>
    <li>
      <a href="../articles/release_notes.html">Release Notes</a>
    </li>
    <li>
      <a href="../articles/citations.html">respR in Use</a>
    </li>
    <li>
      <a href="../articles/future.html">Future Features</a>
    </li>
    <li>
      <a href="../articles/refs.html">References</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Archived</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/archive/intermittent_old.html">Intermittent-flow respirometry: Alternative approaches</a>
        </li>
        <li>
          <a href="../articles/archive/v2_code_change.html">v2.0: Code changes</a>
        </li>
        <li>
          <a href="../articles/archive/v1_code.html">v1.1: How to install and run older code</a>
        </li>
        <li>
          <a href="../articles/archive/auto_rate_performance.html">auto_rate: Performance</a>
        </li>
        <li>
          <a href="../articles/archive/auto_rate_comp.html">auto_rate: Comparisons with LoLinR</a>
        </li>
        <li>
          <a href="../articles/archive/oxy_crit_comp.html">oxy_crit: Comparisons with other packages</a>
        </li>
        <li>
          <a href="../articles/archive/oxy_crit_disc.html">oxy_crit: Discussion of Pcrit estimation methods</a>
        </li>
        <li>
          <a href="../articles/archive/packages_comp.html">respR: Comparisons with other R packages</a>
        </li>
        <li>
          <a href="../articles/archive/usage.html">respR: When to use respR</a>
        </li>
      </ul>
</li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/januarharianto/respr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="auto_rate_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="auto_rate_files/viz-1.8.2/viz.js"></script><link href="auto_rate_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="auto_rate_files/grViz-binding-1.0.10/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>auto_rate: Automatic detection of metabolic
rates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/januarharianto/respr/blob/HEAD/vignettes/auto_rate.Rmd" class="external-link"><code>vignettes/auto_rate.Rmd</code></a></small>
      <div class="hidden name"><code>auto_rate.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In respirometry, we want to report oxygen uptake or production rates
from experimentally important stages or that represent behavioural or
physiological states. These include:</p>
<ul>
<li>the <strong>most linear</strong>, that is most consistent or
monotonic rates observed, often most representative of <em>routine</em>
metabolism</li>
<li>the <strong>lowest</strong> rates observed, often most
representative of <em>standard</em>, <em>resting</em>, <em>basal</em> or
<em>maintenance</em> metabolism</li>
<li>the <strong>highest</strong> rates observed, representative of
<em>active</em> or <em>maximum</em> metabolic rates</li>
</ul>
<p>Identifying and extracting these rates from large datasets is
difficult, and if selected visually, subject to observer bias and lack
of objectivity. Methods such as fitting multiple, fixed-width linear
regressions over an entire dataset to identify regions of lowest or
highest slopes (i.e. rates) is computationally intensive, and slopes
found via this method highly sensitive to the width chosen, especially
if the specimen’s metabolic rate changes rapidly or the data is
noisy.</p>
<p>Here we detail <code><a href="../reference/auto_rate.html">auto_rate()</a></code>, a function that uses machine
learning techniques to <em>automatically</em> detect the <strong>most
linear</strong> regions of a dataset. This allows an investigator to
extract rates in a statistically robust, objective manner. It can also
extract and order <strong>highest</strong> and <strong>lowest</strong>
rates, or return an unordered <strong>rolling</strong> rate across the
whole dataset.</p>
<p>In this vignette we detail how <code>auto_rate</code> works, and how
it can be used to extract rates from respirometry data. Importantly,
<code>auto_rate</code> has been optimised to be <em>extremely fast</em>.
Other methods on large datasets can take minutes, hours or even days to
run. <code>auto_rate</code> can reduce this wait by orders of magnitude,
fitting tens of thousands of regressions and detecting linear regions in
seconds.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This illustrates the main processes involved in
<code>auto_rate</code>:</p>
<div id="htmlwidget-843cc75df833dff343e7" style="width:400px;height:576px;" class="grViz html-widget "></div>
<script type="application/json" data-for="htmlwidget-843cc75df833dff343e7">{"x":{"diagram":"\ndigraph a_nice_graph {\n\n# node definitions with substituted label text\n\nnode [fontname = Helvetica, shape = circle]\nrd [label = \"Raw Data\"]\n\nnode [fontname = Helvetica, shape = rectangle]\nrr [label = \"Rolling linear regression\"]\nkd [label = \"Kernel density\nestimates\"]\nre [label = \"Bandwidth\nresampling\"]\nlr [label = \"Localised linear\nregression\"]\nar [label = \"Rank\"]\nfi [label = \"Filter\"]\nun [label = \"Unorder\"]\nor [label = \"Order\"]\n\nnode [fontname = Menlo, shape = none]\nau [label = \"auto_rate()\"]\nli [label = \"linear\"]\nmm [label = \" highest\nlowest\nmaximum\nminimum\"]\nin [label = \"interval\"]\nro [label = \"rolling\"]\n\n# edge definitions with the node IDs\n\nrr -> kd -> re -> lr -> ar -> li\nrd -> au -> rr -> or -> mm\nrr -> fi -> in\nrr -> un -> ro\n\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p><code>auto_rate</code> works by performing an optimised rolling
regression on the dataset of a specified width. For the
<code>linear</code> method, a kernel density estimate is performed on
the rolling regression output, and the kernel bandwidth used to
re-sample linear regions of the data for re-analysis. For other methods,
the results are filtered, ordered, or returned unordered.</p>
</div>
<div class="section level2">
<h2 id="rolling-linear-regression">Rolling linear regression<a class="anchor" aria-label="anchor" href="#rolling-linear-regression"></a>
</h2>
<p>The function <code>auto_rate</code> uses a novel method of combining
rolling regression and kernel density estimate algorithms to detect
patterns in time series data. The rolling regression runs all possible
ordinary least-squares (OLS) linear regressions <span class="math inline">\((y = \beta_0 + \beta_1 X + \epsilon)\)</span> of a
fixed sample width across the dataset, and is expressed as: <span class="math display">\[y_t(n) = X_t(n) \beta (n) + \epsilon_t(n), \ t =
n,\ ...,\ T\]</span> where <span class="math inline">\(T\)</span> is the
total length of the dataset, <span class="math inline">\(n\)</span> is
the window of width <span class="math inline">\(n &lt; T\)</span>, <span class="math inline">\(y_t(n)\)</span> is the vector of observations
(e.g. oxygen concentration), <span class="math inline">\(X_t(n)\)</span>
is the matrix of explanatory variables, <span class="math inline">\(\beta (n)\)</span> is a vector of regression
parameters and <span class="math inline">\(\epsilon_t(n)\)</span> is a
vector of error terms. Thus, a total of <span class="math inline">\((T -
n) + 1\)</span> number of overlapping regressions are fit.</p>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<p><code>auto_rate</code> has several methods to process, order or
filter the rolling regression results.</p>
<div class="section level3">
<h3 id="method-linear">
<code>method = "linear"</code><a class="anchor" aria-label="anchor" href="#method-linear"></a>
</h3>
<!-- Additional methods are automatically applied when we use `auto_rate` to detect linear sections of the data.  -->
<!-- First, a Gaussian kernel density estimate (KDE) is used to process the regression coefficient $\beta$, based on the key assumption that linear sections of the data are reflected by relatively stable parameters across the rolling estimates. -->
<!-- This assumption is used often in financial statistics to evaluate stability and make predictions on time-series data. -->
<!-- Here, KDE automatically aggregates stable (i.e. linear) sections as they naturally form one or more local maxima ("modes") in the probability density estimate, and if the distribution is multimodal, the modes are ranked by size. -->
<p>This method uses kernel density estimation (KDE) to automatically
identify linear regions of the dataset.</p>
<p>First, we take advantage of the key assumption that linear sections
of a data series are reflected by stable parameters across the rolling
estimates, a property that is often applied in financial statistics to
evaluate model stability and make forward predictions on time-series
data (see Zivot and Wang 2006). We use kernel density estimation (KDE)
techniques, often applied in various inference procedures such as
machine learning, pattern recognition and computer vision, to
automatically aggregate stable (i.e. linear) segments as they naturally
form one or more local maxima (“modes”) in the probability density
estimate.</p>
<p>KDE requires no assumption that the data is from a parametric family,
and learns the shape of the density automatically without supervision.
KDE can be expressed as: <span class="math display">\[\hat{f}(x) =
\frac{1}{nh^d}\sum_{i = 1}^{n} K \left(\frac{x - X_i}{h}
\right)\]</span> where <span class="math inline">\(f\)</span> is the
density function from an unknown distribution <span class="math inline">\(P\)</span> for <span class="math inline">\(X_1,...,X_n\)</span>, <span class="math inline">\(K\)</span> is the kernel function and <span class="math inline">\(h\)</span> is the optimal smoothing bandwidth. The
smoothing bandwidth is computed using the solve-the-equation
<em>plug-in</em> method (Sheather et al. 1996, Sheather and Jones 1991)
which works well with multimodal or non-normal densities (Raykar and
Duraiswami 2006).</p>
<!-- The smoothing bandwidth $h$ is computed using an adjusted kernel bandwidth selector based on Silvermans "rule of thumb" (Silverman, 1986): $$h = \left(\frac{4\hat{\sigma}^5}{3n} \right)^{\frac{1}{5}} \approx 1.06\hat{\sigma}n^{-\frac{1}{5}}$$ where $\hat{\sigma}$ is the standard deviation of the samples and $n$ is the total number of samples.  -->
<p>We then use <span class="math inline">\(h\)</span> to select all
values in the rolling regression output that match the range of values
around each mode (<span class="math inline">\(\theta_n\)</span>) of the
KDE (i.e. <span class="math inline">\(\theta_n \pm h\)</span>). These
rolling estimates are grouped and ranked by size, and the upper and
lower bounds of the data windows they represent are used to re-select
the linear segment of the original data series. The rolling estimates
are then discarded while the detected data segments are analysed using
linear regression.</p>
<p>The output will contain only the regressions identified as coming
from linear regions of the data, ranked by order of the KDE density
analysis. This is present in the <code>$summary</code> component of the
output as <code>$density</code>. Under this method, the
<code>width</code> input is used as a starting seed value, but the
resulting regressions may be of any width.</p>
<div class="section level4">
<h4 id="when-this-method-might-be-applied">When this method might be applied<a class="anchor" aria-label="anchor" href="#when-this-method-might-be-applied"></a>
</h4>
<p>This method could be applied to virtually any respirometry data when
you are looking for linear regions where rates are <em>stable</em>,
<em>consistent</em> and <em>representative</em> rates for the
behavioural or physiological state of the specimen. This could be a
routine metabolic rate, standard or basal metabolic rate, or in the case
of an animal under constant exercise a consistent active metabolic
rate.</p>
</div>
</div>
<div class="section level3">
<h3 id="method-lowest">
<code>method = "lowest"</code><a class="anchor" aria-label="anchor" href="#method-lowest"></a>
</h3>
<p>Every regression of the specified <code>width</code> across the
timeseries is calculated, then ordered using <em>absolute</em> rate
values from lowest to highest. This option can only be used when rates
all have the same sign, and it essentially ignores the sign. Rates will
be ordered from lowest to highest in the <code>$summary</code> table by
absolute value regardless of if they are positive or negative.</p>
<div class="section level4">
<h4 id="when-this-method-might-be-applied-1">When this method might be applied<a class="anchor" aria-label="anchor" href="#when-this-method-might-be-applied-1"></a>
</h4>
<p>When you are looking for the lowest rates across a specific time or
row window, representative of resting, basal or standard metabolic
rates.</p>
</div>
</div>
<div class="section level3">
<h3 id="method-highest">
<code>method = "highest"</code><a class="anchor" aria-label="anchor" href="#method-highest"></a>
</h3>
<p>Every regression of the specified <code>width</code> across the
timeseries is calculated, then ordered using <em>absolute</em> rate
values from highest to lowest. This option can only be used when rates
all have the same sign, and it essentially ignores the sign. Rates will
be ordered from highest to lowest in the <code>$summary</code> table by
absolute value regardless of if they are positive or negative.</p>
<div class="section level4">
<h4 id="when-this-method-might-be-applied-2">When this method might be applied<a class="anchor" aria-label="anchor" href="#when-this-method-might-be-applied-2"></a>
</h4>
<p>When you are looking for the highest rates across a specific time or
row window, representative of maximum or active metabolic rates.</p>
</div>
</div>
<div class="section level3">
<h3 id="method-minimum-method-maximum">
<code>method = "minimum"</code>,
<code>method = "maximum"</code><a class="anchor" aria-label="anchor" href="#method-minimum-method-maximum"></a>
</h3>
<p>These methods are strictly numerical and take full account of the
sign of the rate. In <code>respR</code> oxygen uptake rates are negative
since they represent a negative slope of oxygen against time, and oxygen
production rates are positive.</p>
<p>Every regression of the specified <code>width</code> across the
entire timeseries is calculated, then ordered using <em>numerical</em>
rate values from minimum to maximum for the <code>minimum</code> method,
or vice versa for <code>maximum</code>. Generally this method should
only be used when rates are a mix of oxygen consumption and production
rates, such as when positive rates may result from regressions fit over
flush periods in intermittent-flow respirometry.</p>
<div class="section level4">
<h4 id="when-these-methods-might-be-applied">When these methods might be applied<a class="anchor" aria-label="anchor" href="#when-these-methods-might-be-applied"></a>
</h4>
<p>Generally, for most analyses where high or low rates are of interest
the <code>highest</code> or <code>lowest</code> methods should be used
instead. However, when rates are a mix of negative and positive and you
want the highest or lowest these can be used, but note they order by
<em>numerical</em> value; the highest oxygen <em>uptake</em> rates will
be most <code>minimum</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="method-rolling">
<code>method = "rolling"</code><a class="anchor" aria-label="anchor" href="#method-rolling"></a>
</h3>
<p>This method returns all regressions of the specified
<code>width</code> in sequential order across the dataset. All results
are returned in the summary table.</p>
<div class="section level4">
<h4 id="when-this-method-might-be-applied-3">When this method might be applied<a class="anchor" aria-label="anchor" href="#when-this-method-might-be-applied-3"></a>
</h4>
<p>This method can be applied when you want to extract a rolling rate of
a specified width for further analyses. Alternatively, if you don’t want
to rely on the <code>"linear"</code> selection or other methods but want
to filter and select the results according to various criteria using
<code><a href="../reference/select_rate.html">select_rate()</a></code>. See
<code><a href="../articles/select_rate.html">vignette("select_rate")</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="method-interval">
<code>method = "interval"</code><a class="anchor" aria-label="anchor" href="#method-interval"></a>
</h3>
<p>Multiple, successive, <strong>non</strong>-overlapping regressions of
the specified ‘width’ are extracted from the rolling regressions,
ordered sequentially.</p>
<div class="section level4">
<h4 id="when-this-method-might-be-applied-4">When this method might be applied<a class="anchor" aria-label="anchor" href="#when-this-method-might-be-applied-4"></a>
</h4>
<p>This is chiefly for comparison with historical data, or if you have a
specific reason to specify non-overlapping regressions. For example, in
P<sub>crit</sub> measurements, it was historically common for users to
generate rate~oxygen data by interval-based regressions.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="width">Adjusting the width<a class="anchor" aria-label="anchor" href="#width"></a>
</h2>
<p>By default, <code>auto_rate</code> rolling regression uses a rolling
window width in rows of <code>0.2</code> multiplied by the total rows of
the dataset, that is across a rolling window of 20% of the data. This
can be changed using the <code>width</code> input to a different
relative proportion (e.g. for 10% <code>width = 0.1</code>).
Alternatively, if not between 0 and 1, the <code>width</code> by default
equates to a fixed value in rows
(e.g. <code>width = 2000, by = "row"</code>), or can be entered as a
fixed value in the time metric
(<code>width = 3000, by = "time"</code>).</p>
<p>Note that <code>by = "row"</code> is computationally faster.
Specifying a <code>"time"</code> window tells <code>auto_rate</code>
that the time data may have gaps or not be evenly spaced, and so the
function calculates each time width using the raw time <em>values</em>,
rather than assuming a specific row width represents the same time
window, a less computationally intensive process. If the data are
without gaps and evenly spaced with regards to time,
<code>by = "row"</code> and the correct row <code>width</code> to
represent the time window you want will be much faster.</p>
<p>The <code>width</code> determines the exact width of the data
segments produced for <code>highest</code>, <code>lowest</code>,
<code>rolling</code> etc. rates. This allows the user to consistently
report results across experiments, such as reporting the highest or
lowest rates sustained over a specific time period.</p>
<p>Importantly however, for the <code>linear</code> detection method the
<code>width</code> is a starting seed value, and does <em>not</em>
restrict the width of the segments produced. The minimum width of the
segments tends to be close to or slightly lower than the
<code>width</code> input (though not always), however the upper widths
are not restricted and can be of any width if the segments are found to
be linear.</p>
<p>Users should experiment with different <code>width</code> values to
understand how this affects identification of linear regions and rate
values, especially for small datasets or those with a high relative
degree of noise or residual variation. Choosing an inappropriate width
tends to overfit or underfit the rolling rates. See <a href="https://januarharianto.github.io/respR/articles/refs.html#references">Prinzing
et al. 2021</a> for an excellent discussion of appropriate widths in
rolling regressions to determine maximum metabolic rates, much of which
is relevant to extracting rates of any kind.</p>
<p>Note also that the <code>linear</code> method works best on high
resolution data which has a relatively stable structure, such as a
general decline or increase in oxygen. Patterns such as oscillating
levels of oxygen such as from intermittent-flow respirometry, or flat
areas followed by sudden declines will likely lead to questionable
results. Generally it works best when data is subset to remove regions
which are not of experimental interest. See
<code><a href="../reference/subset_data.html">subset_data()</a></code></p>
<div class="section level3">
<h3 id="overfitting">Overfitting<a class="anchor" aria-label="anchor" href="#overfitting"></a>
</h3>
<p>Below, we show the differences in the shape of the rolling
regressions when using the default <code>width = 0.2</code> versus a
value of <code>0.6</code> with the dataset <code>sardine.rd</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform linear detection; default width when not specified is 0.2:</span></span>
<span><span class="va">normx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sardine.rd</span><span class="op">)</span></span>
<span><span class="co">#&gt; auto_rate: Applying default 'width' of 0.2</span></span>
<span></span>
<span><span class="co"># Perform linear detection using manual width of 0.6:</span></span>
<span><span class="va">overx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sardine.rd</span>, width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-2-1.png" width="960" style="display: block; margin: auto;"></p>
<p>For the <code>linear</code> method, since KDE automatically
aggregates stable values, a poor selection of the <code>width</code> may
result in a badly-characterised rolling rate estimate output. Under
perfectly linear conditions, that is completely monotonic rates, we
would expect a rolling regression output plot such as this to consist of
a straight, horizontal line. In these data, while the default width
allowed a pattern of relative stability in rate after around 2500
seconds to be identified, this information was lost when a
<code>width</code> of <code>0.6</code> was used, with stable rates only
being identified much later in the dataset.</p>
<p>Similarly, if we are interested in highest rate values, under the
lower width input we could see values around -0.0010 occurring within
the first 1000s of the experiment. This information was also completely
lost under the higher width input.</p>
</div>
<div class="section level3">
<h3 id="underfitting">Underfitting<a class="anchor" aria-label="anchor" href="#underfitting"></a>
</h3>
<p>By contrast, if the <code>width</code> is too low the rolling rate is
unstable and heavily influenced by data noise and residual variation.
This leads to poor results for the <code>linear</code> method, and also
highly variable results under the other methods.</p>
<p>Here we’ll compare the default <code>width = 0.2</code> to a lower
value of 5% of the data, <code>width = 0.05</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform linear detection; default width when not specified is 0.2:</span></span>
<span><span class="va">normx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sardine.rd</span><span class="op">)</span></span>
<span><span class="co">#&gt; auto_rate: Applying default 'width' of 0.2</span></span>
<span></span>
<span><span class="co"># Perform linear detection using manual width of 0.05:</span></span>
<span><span class="va">underx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sardine.rd</span>, width <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-3-1.png" width="960" style="display: block; margin: auto;"></p>
<p>A lower width leads to much more variable rolling rate estimates.
Note how we have had to adjust the y-axis limits to fit the results (the
left plot is the same data as in the previous section with different
axis values). In this particular analysis (results not shown) the
<code>linear</code> method performed poorly. If we were interested in
highest or lowest rates, this would also prove problematic since the
rates are so variable.</p>
</div>
<div class="section level3">
<h3 id="appropriate-widths">Appropriate widths<a class="anchor" aria-label="anchor" href="#appropriate-widths"></a>
</h3>
<p>The <code>width</code> value should be carefully considered; too low
and it fails to capture accurate rolling rates and is unduly influenced
by data noise or variability, too high and the data is overfitted with
important physiological or behavioural states smoothed out. Whatever
value is used, this should be reported in the analytical methods
alongside results.</p>
<p>See <a href="https://januarharianto.github.io/respR/articles/refs.html#references">Prinzing
et al. 2021</a> for an excellent discussion of appropriate widths in
rolling regressions to determine maximum metabolic rates, much of which
is relevant to extracting rates of any kind.</p>
</div>
</div>
<div class="section level2">
<h2 id="example-analysis">Example Analysis<a class="anchor" aria-label="anchor" href="#example-analysis"></a>
</h2>
<p>Here we’ll run through examples of how to use <code>auto_rate</code>
to extract rates from respirometry data.</p>
<div class="section level3">
<h3 id="automatic-detection-of-linear-rates">Automatic detection of linear rates<a class="anchor" aria-label="anchor" href="#automatic-detection-of-linear-rates"></a>
</h3>
<p>By default, <code>auto_rate</code> identifies the <em>most
linear</em> regions of the data
(i.e. <code>method = "linear"</code>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sard_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sardine.rd</span><span class="op">)</span></span>
<span><span class="co">#&gt; auto_rate: Applying default 'width' of 0.2</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-4-1.png" width="960" style="display: block; margin: auto;"></p>
<p>This method detects the <em>most consistently linear</em> regions of
the data, that is the most consistent rates observed during the
experiment. It does this in a rigorous, unsupervised manner, with the
advantage being that this removes observer subjectivity in choosing
which rate is most appropriate to report in their results. It is a
statistically robust way of indentifying and reporting consistent rates
in respirometry data, such as those representative of routine or
standard metabolic rates.</p>
</div>
<div class="section level3">
<h3 id="plot1">Interpreting the plots<a class="anchor" aria-label="anchor" href="#plot1"></a>
</h3>
<p>The <code>linear</code> method uses the input <code>width</code> as a
starting seed value to calculate a rolling rate (panel 3). It then uses
these rates to identify linear regions using kernel density estimation
(KDE, panel 6). Peaks in this plot represent linear regions, that is
areas of stable rates at that <code>width</code> representative of that
region as a whole. It then re-samples these regions and runs additional
linear analysis at different widths to arrive at a final rate. This is
why the final, high ranked rates tend to be over widths greater than the
input <code>width</code>, as can be seen here with the top ranked
result.</p>
<p>Generally, the higher and wider the peak in the KDE plot, the more
linear the region. Here there are several (the current plotted one
denoted by a vertical dashed line) and the strongest results are towards
the end of the data, including the highest ranked result. The rate value
of the current plotted result can also be seen in panel 3 as a
horizontal line. This can help assess if it is a representative rate,
although bear in mind these rolling rates are at a different width.</p>
<p>See <a href="#plot2">Plot</a> section below for more information.</p>
</div>
<div class="section level3">
<h3 id="exploring-the-results">Exploring the results<a class="anchor" aria-label="anchor" href="#exploring-the-results"></a>
</h3>
<p>Typically, <code>auto_rate</code> will identify multiple linear
regions. These are ranked using the kernel density analysis, with the
results reflected in the ordering of the <code>$summary</code> table in
the output, which is ordered by the <code>$density</code> column. The
first row is the top ranked, most linear region, and subsequent rows
progressively lower rank. By default, this highest ranked result is
returned when <code>print</code> or <code>plot</code> are used, but
other results can be output using the <code>pos</code> input with those
functions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sard_ar</span>, pos <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.auto_rate # ---------------------</span></span>
<span><span class="co">#&gt; Data extracted by 'row' using 'width' of 1502.</span></span>
<span><span class="co">#&gt; Rates computed using 'linear' method.39 linear regions detected in the kernel density estimate.</span></span>
<span><span class="co">#&gt; To see all results use summary().</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Position 2 of 39 :</span></span>
<span><span class="co">#&gt; Rate: -0.000688 </span></span>
<span><span class="co">#&gt; R.sq: 0.986 </span></span>
<span><span class="co">#&gt; Rows: 2242 to 5543 </span></span>
<span><span class="co">#&gt; Time: 2241 to 5542 </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sard_ar</span>, pos <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-6-1.png" width="960" style="display: block; margin: auto;"></p>
<p><strong>Users should take special note</strong> that as an automated,
unsupervised machine learning method of identifying linear data
<code>auto_rate</code> is fallible, and the results should
<em>always</em> be inspected and explored. In this case the function has
identified a total of 46 linear regions. They can be viewed by calling
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sard_ar</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.auto_rate # -------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Summary of Results by Kernel Density Rank ===</span></span>
<span><span class="co">#&gt;     rep rank intercept_b0  slope_b1   rsq density  row endrow time endtime  oxy endoxy      rate</span></span>
<span><span class="co">#&gt;  1:  NA    1         94.9 -0.000661 0.982   19082 3659   6736 3658    6735 92.6   90.4 -0.000661</span></span>
<span><span class="co">#&gt;  2:  NA    2         95.1 -0.000688 0.986   17476 2242   5543 2241    5542 93.7   91.2 -0.000688</span></span>
<span><span class="co">#&gt;  3:  NA    3         94.9 -0.000662 0.987   15982 3628   7164 3627    7163 92.5   90.2 -0.000662</span></span>
<span><span class="co">#&gt;  4:  NA    4         95.1 -0.000708 0.979    9211 1578   4236 1577    4235 94.2   92.2 -0.000708</span></span>
<span><span class="co">#&gt;  5:  NA    5         95.1 -0.000706 0.971    7562 1947   4236 1946    4235 93.8   92.2 -0.000706</span></span>
<span><span class="co">#&gt; ---                                                                                             </span></span>
<span><span class="co">#&gt; 35:  NA   35         95.5 -0.000894 0.938     421 1063   2394 1062    2393 94.5   93.5 -0.000894</span></span>
<span><span class="co">#&gt; 36:  NA   36         95.5 -0.000894 0.937     388 1066   2393 1065    2392 94.7   93.4 -0.000894</span></span>
<span><span class="co">#&gt; 37:  NA   37         95.3 -0.000803 0.929     376 1315   2641 1314    2640 94.3   93.3 -0.000803</span></span>
<span><span class="co">#&gt; 38:  NA   38         95.3 -0.000803 0.929     369 1317   2641 1316    2640 94.3   93.3 -0.000803</span></span>
<span><span class="co">#&gt; 39:  NA   39         95.3 -0.000803 0.928     322 1325   2635 1324    2634 94.2   93.3 -0.000803</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regressions : 6012 | Results : 39 | Method : linear | Roll width : 1502 | Roll type : row </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>In this case the first rate result looks good: it has a high
r-squared, is sustained over a duration of 50 minutes, and the rate
value is consistent with the other results. However in some cases, other
ranked results may be more appropriate to report depending on the
metabolic rate metric being investigated.</p>
<p>While the first result is the highest in terms of the kernel density
value, the user is free to select and report other linear results if
they satisfy other desirable criteria, for instance are above a
particular r-squared value or span a minimum time window. One
peculiarity to take note of in the KDE analysis, is that sometimes the
top ranked result does not necessarily have the highest r-squared. This
is a counter intuitive result, but explained by the fact that the
function learns the shape of the entire dataset, so a particular
regression from a linear region might be most representative of the
rates in that region, but just happen to be fit to values which return a
lower r-squared. This does not mean it is not a valid result; arguably,
it is more valid, since it is accurately describing the localised shape
of the data. See Chabot et al. (<a href="https://januarharianto.github.io/respR/articles/refs.html#references">2021</a>)
for discussion of r-squared values in metabolic rate measurements.</p>
<p>The <code>pos</code> input can also be used in <code>summary</code>
to view particular row ranges. We’ll look at the first 10.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sard_ar</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.auto_rate # -------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Summary of results from entered 'pos' rank(s) ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rep rank intercept_b0  slope_b1   rsq density  row endrow time endtime  oxy endoxy      rate</span></span>
<span><span class="co">#&gt;  1:  NA    1         94.9 -0.000661 0.982   19082 3659   6736 3658    6735 92.6   90.4 -0.000661</span></span>
<span><span class="co">#&gt;  2:  NA    2         95.1 -0.000688 0.986   17476 2242   5543 2241    5542 93.7   91.2 -0.000688</span></span>
<span><span class="co">#&gt;  3:  NA    3         94.9 -0.000662 0.987   15982 3628   7164 3627    7163 92.5   90.2 -0.000662</span></span>
<span><span class="co">#&gt;  4:  NA    4         95.1 -0.000708 0.979    9211 1578   4236 1577    4235 94.2   92.2 -0.000708</span></span>
<span><span class="co">#&gt;  5:  NA    5         95.1 -0.000706 0.971    7562 1947   4236 1946    4235 93.8   92.2 -0.000706</span></span>
<span><span class="co">#&gt;  6:  NA    6         95.7 -0.001047 0.961    6865  601   1969  600    1968 95.1   93.7 -0.001047</span></span>
<span><span class="co">#&gt;  7:  NA    7         95.1 -0.000709 0.978    6399 1578   4196 1577    4195 94.2   92.2 -0.000709</span></span>
<span><span class="co">#&gt;  8:  NA    8         94.8 -0.000628 0.929    6288 5050   6613 5049    6612 91.4   90.5 -0.000628</span></span>
<span><span class="co">#&gt;  9:  NA    9         94.7 -0.000619 0.912    2611 5123   6507 5122    6506 91.5   90.6 -0.000619</span></span>
<span><span class="co">#&gt; 10:  NA   10         95.7 -0.001043 0.961    1918  596   1981  595    1980 95.0   93.6 -0.001043</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regressions : 6012 | Results : 39 | Method : linear | Roll width : 1502 | Roll type : row </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Here, the 6th ranked result, while being a valid linear region, is
conspicuously higher in rate value and occurs close to the start of the
experiment. If we were interested in routine or standard metabolic
rates, we would want to exclude this one, as it suggests the specimen
might not yet be acclimated to the chamber.</p>
<p>In most cases the best option is to use the top ranked result unless
there are specific reasons to exclude it. However, an investigator may
opt to select several and take a mean of the resulting rates. For
instance here, we might decide on a mean of the top 3 since they have
the highest <code>$density</code> values (note that typically we would
do this after rates have been adjusted and converted - see later
sections - but it is possible here too). We could just average the top 3
values ourselves, but the <code>mean</code> function will also work with
<code>auto_rate</code> objects and accepts the <code>pos</code>
input.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sard_ar</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # mean.auto_rate # ----------------------</span></span>
<span><span class="co">#&gt; Mean of rate results from entered 'pos' ranks:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mean of 3 output rates:</span></span>
<span><span class="co">#&gt; [1] -0.00067</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Any rate value determined after such selection can be saved as a
variable, or entered manually as a value in later functions such as
<code>adjust_rate</code> and <code>convert_rate</code>. It can also be
exported as a value by using <code>export = TRUE</code> in the
<code>mean</code> call. However, see next section.</p>
</div>
<div class="section level3">
<h3 id="select_rate">
<code>select_rate</code><a class="anchor" aria-label="anchor" href="#select_rate"></a>
</h3>
<p>Alternative selection criteria might also be applied. This might
include excluding all results below a certain r-squared, use only the
top n’th percentile of results, or exclude those from the certain stages
of the experiment.</p>
<p>New in <code>respR v2.0</code> is the <code><a href="../reference/select_rate.html">select_rate()</a></code>
function which can apply these criteria, along with many others, to
<code>auto_rate</code> results after they have been converted in
<code>convert_rate</code>. See <code><a href="../articles/select_rate.html">vignette("select_rate")</a></code> for
how to do advanced filtering of these results.</p>
</div>
<div class="section level3">
<h3 id="highest-rates">Highest rates<a class="anchor" aria-label="anchor" href="#highest-rates"></a>
</h3>
<p><code>auto_rate</code> can also be used to detect the
<em>highest</em> and <em>lowest</em> rates over a fixed
<code>width</code>. This allows for consistent reporting of respirometry
results, such as the highest or lowest rates sustained over a specified
time period.</p>
<p>Here we want to know the highest rates sustained over 15 minutes, or
900s, in the <code>sardine.rd</code> data. Since in these data, oxygen
is recorded every second and <code><a href="../reference/inspect.html">inspect()</a></code> tells us the time
data is gapless and evenly spaced, we can simply specify width in the
same number of rows.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sard_insp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">sardine.rd</span><span class="op">)</span></span>
<span><span class="co">#&gt; inspect: Applying column default of 'time = 1'</span></span>
<span><span class="co">#&gt; inspect: Applying column default of 'oxygen = 2'</span></span>
<span><span class="co">#&gt; inspect: No issues detected while inspecting data frame.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.inspect # -----------------------</span></span>
<span><span class="co">#&gt;                 Time Oxygen</span></span>
<span><span class="co">#&gt; numeric         pass   pass</span></span>
<span><span class="co">#&gt; Inf/-Inf        pass   pass</span></span>
<span><span class="co">#&gt; NA/NaN          pass   pass</span></span>
<span><span class="co">#&gt; sequential      pass      -</span></span>
<span><span class="co">#&gt; duplicated      pass      -</span></span>
<span><span class="co">#&gt; evenly-spaced   pass      -</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">high_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sard_insp</span>, width <span class="op">=</span> <span class="fl">900</span>, by <span class="op">=</span> <span class="st">"row"</span>, method <span class="op">=</span> <span class="st">"highest"</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-11-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">high_rate</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.auto_rate # -------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Summary of Results by Highest Rate ===</span></span>
<span><span class="co">#&gt;       rep rank intercept_b0  slope_b1   rsq density  row endrow time endtime  oxy endoxy      rate</span></span>
<span><span class="co">#&gt;    1:  NA    1         95.8 -0.001138 0.924      NA  791   1690  790    1689 95.0   93.9 -0.001138</span></span>
<span><span class="co">#&gt;    2:  NA    2         95.8 -0.001138 0.924      NA  798   1697  797    1696 95.0   93.8 -0.001138</span></span>
<span><span class="co">#&gt;    3:  NA    3         95.8 -0.001138 0.924      NA  792   1691  791    1690 95.0   93.9 -0.001138</span></span>
<span><span class="co">#&gt;    4:  NA    4         95.8 -0.001138 0.924      NA  793   1692  792    1691 95.0   93.9 -0.001138</span></span>
<span><span class="co">#&gt;    5:  NA    5         95.8 -0.001138 0.924      NA  797   1696  796    1695 95.0   93.8 -0.001138</span></span>
<span><span class="co">#&gt;   ---                                                                                             </span></span>
<span><span class="co">#&gt; 6610:  NA 6610         94.7 -0.000615 0.793      NA 5717   6616 5716    6615 91.3   90.6 -0.000615</span></span>
<span><span class="co">#&gt; 6611:  NA 6611         94.7 -0.000615 0.792      NA 5723   6622 5722    6621 91.1   90.7 -0.000615</span></span>
<span><span class="co">#&gt; 6612:  NA 6612         94.7 -0.000615 0.793      NA 5715   6614 5714    6613 91.1   90.5 -0.000615</span></span>
<span><span class="co">#&gt; 6613:  NA 6613         94.7 -0.000614 0.792      NA 5720   6619 5719    6618 91.1   90.5 -0.000614</span></span>
<span><span class="co">#&gt; 6614:  NA 6614         94.7 -0.000613 0.792      NA 5719   6618 5718    6617 91.2   90.7 -0.000613</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regressions : 6614 | Results : 6614 | Method : highest | Roll width : 900 | Roll type : row </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>In the <code>highest</code> and <code>lowest</code> methods the rates
are ordered by the <em>absolute</em> rate value, regardless of the sign.
The top results here have the same rate value as printed, but likely
have small differences at higher precision (what you see printed depends
on your own R <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> settings). Again, a user may choose
to report the top result or perform further selection and filtering
using <code><a href="../reference/select_rate.html">select_rate()</a></code> after conversion in
<code>convert_rate</code>. This includes the option to remove rates
which overlap, that is share the same rows of data; as we can see here
the top results all come from the same region of the data.</p>
</div>
<div class="section level3">
<h3 id="lowest-rates">Lowest rates<a class="anchor" aria-label="anchor" href="#lowest-rates"></a>
</h3>
<p>We can similarly find the <code>lowest</code> rate over 15
minutes.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sard_insp</span>, width <span class="op">=</span> <span class="fl">900</span>, method <span class="op">=</span> <span class="st">"lowest"</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-13-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">low_rate</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.auto_rate # ---------------------</span></span>
<span><span class="co">#&gt; Data extracted by 'row' using 'width' of 900.</span></span>
<span><span class="co">#&gt; Rates computed using 'lowest' method.To see all results use summary().</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Position 1 of 6614 :</span></span>
<span><span class="co">#&gt; Rate: -0.000613 </span></span>
<span><span class="co">#&gt; R.sq: 0.792 </span></span>
<span><span class="co">#&gt; Rows: 5719 to 6618 </span></span>
<span><span class="co">#&gt; Time: 5718 to 6617 </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">low_rate</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.auto_rate # -------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Summary of Results by Lowest Rate ===</span></span>
<span><span class="co">#&gt;       rep rank intercept_b0  slope_b1   rsq density  row endrow time endtime  oxy endoxy      rate</span></span>
<span><span class="co">#&gt;    1:  NA    1         94.7 -0.000613 0.792      NA 5719   6618 5718    6617 91.2   90.7 -0.000613</span></span>
<span><span class="co">#&gt;    2:  NA    2         94.7 -0.000614 0.792      NA 5720   6619 5719    6618 91.1   90.5 -0.000614</span></span>
<span><span class="co">#&gt;    3:  NA    3         94.7 -0.000615 0.793      NA 5715   6614 5714    6613 91.1   90.5 -0.000615</span></span>
<span><span class="co">#&gt;    4:  NA    4         94.7 -0.000615 0.792      NA 5723   6622 5722    6621 91.1   90.7 -0.000615</span></span>
<span><span class="co">#&gt;    5:  NA    5         94.7 -0.000615 0.793      NA 5717   6616 5716    6615 91.3   90.6 -0.000615</span></span>
<span><span class="co">#&gt;   ---                                                                                             </span></span>
<span><span class="co">#&gt; 6610:  NA 6610         95.8 -0.001138 0.924      NA  797   1696  796    1695 95.0   93.8 -0.001138</span></span>
<span><span class="co">#&gt; 6611:  NA 6611         95.8 -0.001138 0.924      NA  793   1692  792    1691 95.0   93.9 -0.001138</span></span>
<span><span class="co">#&gt; 6612:  NA 6612         95.8 -0.001138 0.924      NA  792   1691  791    1690 95.0   93.9 -0.001138</span></span>
<span><span class="co">#&gt; 6613:  NA 6613         95.8 -0.001138 0.924      NA  798   1697  797    1696 95.0   93.8 -0.001138</span></span>
<span><span class="co">#&gt; 6614:  NA 6614         95.8 -0.001138 0.924      NA  791   1690  790    1689 95.0   93.9 -0.001138</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regressions : 6614 | Results : 6614 | Method : lowest | Roll width : 900 | Roll type : row </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note, the output objects of the <code>highest</code> and
<code>lowest</code> methods are essentially identical, the only
difference being the results are ordered descending or ascending by
absolute rate value.</p>
</div>
<div class="section level3">
<h3 id="rolling-rates">Rolling rates<a class="anchor" aria-label="anchor" href="#rolling-rates"></a>
</h3>
<p>The <code>rolling</code> method allows a rolling regression of the
specified <code>width</code> to be returned in sequential order.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roll_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sard_insp</span>, width <span class="op">=</span> <span class="fl">900</span>, method <span class="op">=</span> <span class="st">"rolling"</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-16-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">roll_rate</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.auto_rate # -------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Summary of Results by Rolling Order ===</span></span>
<span><span class="co">#&gt;       rep rank intercept_b0  slope_b1   rsq density  row endrow time endtime  oxy endoxy      rate</span></span>
<span><span class="co">#&gt;    1:  NA    1         95.6 -0.000817 0.871      NA    1    900    0     899 95.6   94.9 -0.000817</span></span>
<span><span class="co">#&gt;    2:  NA    2         95.6 -0.000818 0.871      NA    2    901    1     900 95.6   94.7 -0.000818</span></span>
<span><span class="co">#&gt;    3:  NA    3         95.6 -0.000817 0.871      NA    3    902    2     901 95.6   94.9 -0.000817</span></span>
<span><span class="co">#&gt;    4:  NA    4         95.6 -0.000817 0.871      NA    4    903    3     902 95.6   94.7 -0.000817</span></span>
<span><span class="co">#&gt;    5:  NA    5         95.6 -0.000817 0.871      NA    5    904    4     903 95.6   94.8 -0.000817</span></span>
<span><span class="co">#&gt;   ---                                                                                             </span></span>
<span><span class="co">#&gt; 6610:  NA 6610         95.0 -0.000666 0.845      NA 6610   7509 6609    7508 90.6   90.0 -0.000666</span></span>
<span><span class="co">#&gt; 6611:  NA 6611         95.0 -0.000665 0.844      NA 6611   7510 6610    7509 90.7   90.1 -0.000665</span></span>
<span><span class="co">#&gt; 6612:  NA 6612         94.9 -0.000663 0.843      NA 6612   7511 6611    7510 90.7   90.1 -0.000663</span></span>
<span><span class="co">#&gt; 6613:  NA 6613         94.9 -0.000660 0.841      NA 6613   7512 6612    7511 90.5   90.2 -0.000660</span></span>
<span><span class="co">#&gt; 6614:  NA 6614         94.9 -0.000658 0.837      NA 6614   7513 6613    7512 90.5   90.3 -0.000658</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regressions : 6614 | Results : 6614 | Method : rolling | Roll width : 900 | Roll type : row </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>This outputs every regression of the <code>width</code> in order. The
main utility of this method is for passing to <code>select_rate</code>
after conversion in <code>convert_rate</code> where various criteria can
be applied to filter the results manually. See
<code><a href="../articles/select_rate.html">vignette("select_rate")</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="further-processing">Further processing<a class="anchor" aria-label="anchor" href="#further-processing"></a>
</h2>
<p>Saved <code>auto_rate</code> objects can be passed to subsequent
<code>respR</code> functions for further processing, such as
<code><a href="../reference/adjust_rate.html">adjust_rate()</a></code> to adjust for background respiration, or
<code><a href="../reference/convert_rate.html">convert_rate()</a></code> to convert to final oxygen uptake units. See
other vignettes for examples of these operations.</p>
</div>
<div class="section level2">
<h2 id="plot2">Plot<a class="anchor" aria-label="anchor" href="#plot2"></a>
</h2>
<p>When using <code>auto_rate</code>, a plot of the results is produced
(unless <code>plot = FALSE</code>). If there are multiple results each
can be plotted individually using <code>pos</code>. Each panel can be
plotted on its own using <code>panel</code> with values 1 to 6. If
labels or legends obscure parts of the plot they can be suppressed using
<code>legend = FALSE</code>. Console output messages can be suppressed
with <code>quiet = TRUE</code>. Lastly, the rolling rate plot can be
plotted on an unreversed y-axis with <code>rate.rev = FALSE</code>, if
for instance you are examining oxygen production rates.</p>
<p>The first panel is the complete timeseries of oxygen against both
time (bottom blue axis) and row index (top red axis) with the
<code>pos</code> rate regression (defualt is <code>pos = 1</code>)
highlighted in yellow. The next plot is a close-up of this rate region.
The next is a rolling rate plot across the entire timeseries at the
input <code>width</code> (see <a href="#width">here</a>). The next two
are diagnostic plots of the fitted values vs. residuals for the current
rate result. Lastly, the sixth panel (only for the <code>linear</code>
method) is a plot of the kernel density analysis output, which is the
density peaks of stable rate values.</p>
<p>See <a href="#plot1">Interpreting the plots</a> section above for
more information.</p>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<ul>
<li><p><code>auto_rate</code> does not currently support analysis of
flowthrough respirometry data. See <code><a href="../articles/flowthrough.html">vignette("flowthrough")</a></code>
for analysis of these experiments.</p></li>
<li><p>The <code>auto_rate</code> <code>linear</code> method works best
with data that is fairly monotonic, that is shows an either downward or
upward trend without strong fluctuations. With intermittent-flow
respirometry data there is a strong possibility flush periods will
confuse the <code>auto_rate</code> algorithms, so it should typically
only be run on subsets of the data containing actual specimen
measurements. The <code>subset_data</code> function is ideal for
subsetting and passing data regions of interest to other functions. See
<code><a href="../articles/intermittent_long.html">vignette("intermittent_long")</a></code>.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicholas Carey, Januar Harianto.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
