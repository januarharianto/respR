<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>adjust_rate: Adjusting rates for background • respR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="adjust_rate: Adjusting rates for background">
<meta property="og:description" content="respR">
<meta property="og:image" content="https://januarharianto.github.io/respR/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">respR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/respR.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">---- Complete Workflows ----</li>
    <li>
      <a href="../articles/closed.html">Closed-chamber respirometry</a>
    </li>
    <li>
      <a href="../articles/intermittent_short.html">Intermittent-flow respirometry: Short experiment</a>
    </li>
    <li>
      <a href="../articles/intermittent_long.html">Intermittent-flow respirometry: Long experiment</a>
    </li>
    <li>
      <a href="../articles/flowthrough.html">Flowthrough respirometry</a>
    </li>
    <li>
      <a href="../articles/oxycrit.html">Critical oxygen values (PCrit)</a>
    </li>
    <li>
      <a href="../articles/oxy_production.html">Oxygen production respirometry</a>
    </li>
    <li class="dropdown-header">---- Function Guides ----</li>
    <li>
      <a href="../articles/inspecting.html">inspect: Inspecting data</a>
    </li>
    <li>
      <a href="../articles/subset_data.html">subset_data: Subset data by time, row, or oxygen ranges</a>
    </li>
    <li>
      <a href="../articles/calc_rate.html">calc_rate: Manually select and calculate rates</a>
    </li>
    <li>
      <a href="../articles/calc_rate.int.html">calc_rate.int: Manual extraction of rates in intermittent-flow respirometry</a>
    </li>
    <li>
      <a href="../articles/auto_rate.html">auto_rate: Automatic detection of linear rates</a>
    </li>
    <li>
      <a href="../articles/auto_rate.int.html">auto_rate.int: Automatic extraction of rates in intermittent-flow respirometry</a>
    </li>
    <li>
      <a href="../articles/adjust_rate.html">adjust_rate: Adjusting rates for background</a>
    </li>
    <li>
      <a href="../articles/select_rate.html">select_rate: Exploring and filtering results</a>
    </li>
    <li>
      <a href="../articles/format_time.html">format_time: Convert date-time data to numeric time</a>
    </li>
    <li>
      <a href="../articles/convert_DO.html">convert_DO: Convert between units of dissolved oxygen</a>
    </li>
    <li class="dropdown-header">---- Miscellaneous ----</li>
    <li>
      <a href="../articles/importing.html">Importing files from oxygen probe systems</a>
    </li>
    <li>
      <a href="../articles/twopoint.html">Two-point rate calculation</a>
    </li>
    <li>
      <a href="../articles/subsample.html">Thin larger datasets</a>
    </li>
    <li>
      <a href="../articles/tidyverse.html">Integration with the tidyverse</a>
    </li>
    <li>
      <a href="../articles/reproducibility.html">Reporting reproducibile analyses</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/contact.html">Contact</a>
    </li>
    <li>
      <a href="../articles/release_notes.html">Release Notes</a>
    </li>
    <li>
      <a href="../articles/citations.html">respR Citations</a>
    </li>
    <li>
      <a href="../articles/future.html">Future Features</a>
    </li>
    <li>
      <a href="../articles/refs.html">References</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Archived</a>
      <ul class="dropdown-menu" role="menu">
<li>
          <a href="../articles/archive/intermittent_old.html">Intermittent-flow respirometry: Alternative approaches</a>
        </li>
        <li>
          <a href="../articles/archive/v2_code_change.html">v2.0: Code changes</a>
        </li>
        <li>
          <a href="../articles/archive/v1_code.html">v1.1: How to install and run older code</a>
        </li>
        <li>
          <a href="../articles/archive/auto_rate_performance.html">auto_rate: Performance</a>
        </li>
        <li>
          <a href="../articles/archive/auto_rate_comp.html">auto_rate: Comparisons with LoLinR</a>
        </li>
        <li>
          <a href="../articles/archive/oxy_crit_comp.html">oxy_crit: Comparisons with other packages</a>
        </li>
        <li>
          <a href="../articles/archive/oxy_crit_disc.html">oxy_crit: Discussion of Pcrit estimation methods</a>
        </li>
        <li>
          <a href="../articles/archive/packages_comp.html">respR: Comparisons with other R packages</a>
        </li>
        <li>
          <a href="../articles/archive/usage.html">respR: When to use respR</a>
        </li>
      </ul>
</li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/januarharianto/respr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>adjust_rate: Adjusting rates for background</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/januarharianto/respr/blob/HEAD/vignettes/adjust_rate.Rmd" class="external-link"><code>vignettes/adjust_rate.Rmd</code></a></small>
      <div class="hidden name"><code>adjust_rate.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="adjintro">Introduction<a class="anchor" aria-label="anchor" href="#adjintro"></a>
</h2>
<p>New in <code>respR</code> v2.0 is the ability for
<code><a href="../reference/adjust_rate.html">adjust_rate()</a></code> to perform dynamic and other types of
adjustments to calculated rates.</p>
<p>After calculating background rates from a control or “blank”
experiment, the function can adjust rates from <code>calc_rate</code>,
<code>calc_rate.int</code>, <code>auto_rate</code>,
<code>auto_rate.int</code>, or numeric values in the following ways:</p>
<ul>
<li><p>By a single value</p></li>
<li><p>By a mean of multiple values</p></li>
<li><p>By a rate determined from an equivalent window in a
concurrently-run control</p></li>
<li><p>By a dynamic rate which changes over the course of an
experiment</p></li>
</ul>
<p>In addition, there are several variations on these adjustment
methods.</p>
<p>We use the interlinked <code>respR</code> functions of
<code>inspect</code>, <code>calc_rate</code>, <code>calc_rate.bg</code>
etc. in the following examples, but for most data frames or numeric
values can also be used. We’ll show some examples of these below.</p>
<div class="section level3">
<h3 id="measurement-units-and-running-controls">Measurement units and running controls<a class="anchor" aria-label="anchor" href="#measurement-units-and-running-controls"></a>
</h3>
<p><code>respR</code> analyses are largely unitless; units are only
required when the rates come to be converted in
<code><a href="../reference/convert_rate.html">convert_rate()</a></code>. However, note that the raw background data
should be in the <em>same units</em> of time and oxygen as the raw data
used to calculate the rate being adjusted. The background recording
should also be conducted using the same equipment and under the same
conditions as the experiment to be adjusted, or as close as is
practically possible. This includes using the same or identical
respirometry chambers; in our experience the vast majority of background
oxygen use comes from bacterial growth on the internal surfaces of the
respirometer, not from organisms in the water.</p>
<p>Note that in general the background recording does not have to be
conducted at the same time as experiments, or even over the same
duration as the experimental chambers to be adjusted. While this is
ideal practice, it’s not always practical. Their purpose is to establish
the general relationship of background oxygen change per unit time which
can then be applied to specimen experiments of any length.</p>
</div>
<div class="section level3">
<h3 id="when-should-adjustments-be-applied">When should adjustments be applied?<a class="anchor" aria-label="anchor" href="#when-should-adjustments-be-applied"></a>
</h3>
<p>In the <code>respR</code> workflow, <code>adjust_rate</code> should
be used on rates which have been determined in <code>calc_rate</code>,
<code>calc_rate.int</code>, <code>auto_rate</code>, or
<code>auto_rate.int</code> or rate values (change in oxygen units per
unit time) otherwise determined from the raw data, but before they are
converted in <code>convert_rate</code>.</p>
<p>However, adjustment of rates is an optional step. While it is
extremely important to determine and quantify background oxygen use or
production, many respirometry experiments find it to be negligible in
comparison to specimen rates because equipment is kept clean and
filtered or sterilised water is used, and adjustments are unnecessary
(e.g. <a href="https://januarharianto.github.io/respR/articles/refs.html#references">Burford
et al. 2019</a>).</p>
</div>
<div class="section level3">
<h3 id="sign">Sign of the rates<a class="anchor" aria-label="anchor" href="#sign"></a>
</h3>
<p>If entering specimen or background rates as values, care should be
taken to enter them with the correct <em>sign</em>. In
<code>respR</code> oxygen uptake rates are negative, as they represent a
negative slope of oxygen against time. Background rates will normally
also be a negative value (though not always). For oxygen production
rates, which are positive, the background rates may be negative or
positive. And there are other cases where background rates may be
positive, such as in open-tank or open-arena respirometry where oxygen
may be added at the water surface.</p>
</div>
<div class="section level3">
<h3 id="crbgvcr">Using <code>calc_rate.bg</code> vs. <code>calc_rate</code> for
background rates<a class="anchor" aria-label="anchor" href="#crbgvcr"></a>
</h3>
<p>For the most part we use <code>calc_rate.bg</code> to determine
background rates in the following examples, which are then passed to
<code>adjust_rate</code> as the <code>by</code> input. However,
<code><a href="../reference/calc_rate.html">calc_rate()</a></code> can also be used to determine background rates
for use as the <code>by</code> input.</p>
<p>These two functions are similar in functionality but have a couple of
key differences.</p>
<p><code>calc_rate.bg</code> does not have the region selection inputs
that <code>calc_rate</code> does. It calculates the rate across the
whole oxygen~time dataset as entered. However it allows background rates
to be calculated from multiple columns, which is required for several
adjustment methods, and is the default behaviour if a multiple column
dataset is entered. For this reason it also has <code>oxygen</code> and
<code>time</code> column identifiers to specify particular columns,
which <code>calc_rate</code> does not. If the background data needs to
be subset from a larger dataset to a particular region, this is easy to
do using <code><a href="../reference/subset_data.html">subset_data()</a></code> before passing it on to
<code>calc_rate.bg</code>.</p>
<p><code>calc_rate</code> does have region selection inputs, and also
allows you to extract rates from multiple regions of a single
oxygen~time dataset. This is not particularly useful in the context of
background rates, unless you want to average rates from different
regions of the same data for some reason. However, to extract a single
background rate from a particular region of a larger dataset it is an
option and does not require you to subset the data first. It also does
not have <code>oxygen</code> and <code>time</code> column identifiers.
Data should already have been put into the structure of time in column 1
and oxygen in column 2 via processing in <code><a href="../reference/inspect.html">inspect()</a></code>, or if a
<code>data.frame</code> is used already be in this structure. Any other
columns are ignored.</p>
<p>Overall, we find it easier to mentally partition specimen and
background rates by using <code>calc_rate</code> for one and
<code>calc_rate.bg</code> for the other, but it comes down to personal
preference and the specifics of an experiment and what you want to
achieve.</p>
<p>To summarise the differences:</p>
<p><code>calc_rate.bg</code> - calculate rates from the <em>same</em>
region of <em>single or multiple</em> oxygen columns.</p>
<p><code>calc_rate</code> - calculate rates from <em>single or
multiple</em> regions of a <em>single</em> oxygen column.</p>
</div>
<div class="section level3">
<h3 id="pipes">Pipes<a class="anchor" aria-label="anchor" href="#pipes"></a>
</h3>
<p>We use the new native <code>|&gt;</code> pipes introduced in <a href="https://www.r-bloggers.com/2021/05/new-features-in-r-4-1-0/" class="external-link">R
v4.1</a> extensively in this vignette to save space and streamline the
code. These can be replaced with <code>dplyr</code> pipes
(<code>%&gt;%</code>) if you have not yet updated. Alternatively, save
the output objects and enter them as the first input of the next
function.</p>
</div>
<div class="section level3">
<h3 id="flowthrough-respirometry">Flowthrough respirometry<a class="anchor" aria-label="anchor" href="#flowthrough-respirometry"></a>
</h3>
<p>See <code><a href="../articles/flowthrough.html">vignette("flowthrough")</a></code> for how to adjust
flowthrough respirometry rates.</p>
</div>
</div>
<div class="section level2">
<h2 id="case-studies">Case studies<a class="anchor" aria-label="anchor" href="#case-studies"></a>
</h2>
<p>In this vignette we will run through several hypothetical case
studies which should cover most use cases. If there are any we have not,
please <a href="https://januarharianto.github.io/respR/articles/contact.html"><strong>get
in touch</strong></a> and we’ll try to cover them here or build in
support in a future update.</p>
</div>
<div class="section level2">
<h2 id="case1">Case 1: Single specimen chamber and a single control<a class="anchor" aria-label="anchor" href="#case1"></a>
</h2>
<p><em>“We have a single experiment chamber and have extracted a single
rate from it, and we want to adjust it by a background rate from a
single blank chamber”</em></p>
<p>This is the most straightforward adjustment operation. This is for
cases where a single blank experiment has been run to determine the
background rate of oxygen use or production, and you want to use this
rate to adjust one or more specimen rates.</p>
<p>The <code>urchins.rd</code> dataset has recordings of oxygen
consumption from 16 sea urchins, plus two background recordings in
columns 18 and 19. We will adjust a single rate from one urchin
determined via <code>calc_rate</code> using one of these background
chambers.</p>
<div class="section level3">
<h3 id="calculate-background-rate">Calculate background rate<a class="anchor" aria-label="anchor" href="#calculate-background-rate"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate background rate using calc_rate.bg</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-2-1.png" width="960" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.inspect # -----------------------</span></span>
<span><span class="co">#&gt;                 time.min   b1</span></span>
<span><span class="co">#&gt; numeric             pass pass</span></span>
<span><span class="co">#&gt; Inf/-Inf            pass pass</span></span>
<span><span class="co">#&gt; NA/NaN              pass pass</span></span>
<span><span class="co">#&gt; sequential          pass    -</span></span>
<span><span class="co">#&gt; duplicated          pass    -</span></span>
<span><span class="co">#&gt; evenly-spaced       WARN    -</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uneven Time data locations (first 20 shown) in column: time.min </span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">#&gt; Minimum and Maximum intervals in uneven Time data: </span></span>
<span><span class="co">#&gt; [1] 0.1 0.2</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # plot.calc_rate.bg # -------------------</span></span>
<span><span class="co">#&gt; plot.calc_rate.bg: Plotting all 1 background rates ...</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.000765</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.000765</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
<p>Note that using <code><a href="../reference/inspect.html">inspect()</a></code> to prepare data, while we
strongly recommend it (see <code><a href="../articles/inspecting.html">vignette("inspecting")</a></code>), is
optional. <code>calc_rate.bg</code> will also accept a
<code>data.frame</code> directly, and has its own column identifier
inputs. This code will perform exactly the same rate calculation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate background rate using calc_rate.bg</span></span>
<span><span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> </span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # plot.calc_rate.bg # -------------------</span></span>
<span><span class="co">#&gt; plot.calc_rate.bg: Plotting all 1 background rates ...</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.000765</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.000765</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calculate-specimen-rate">Calculate specimen rate<a class="anchor" aria-label="anchor" href="#calculate-specimen-rate"></a>
</h3>
<p>Now we calculate the rate of one of the specimens.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate urchin rate using calc_rate</span></span>
<span><span class="va">urch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # plot.calc_rate # ----------------------</span></span>
<span><span class="co">#&gt; plot.calc_rate: Plotting rate from position 1 of 1 ...</span></span></code></pre>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-5-1.png" width="960" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; -----------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate # ---------------------</span></span>
<span><span class="co">#&gt; Rank 1 of 1 rates:</span></span>
<span><span class="co">#&gt; Rate: -0.0286 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adjust-rate">Adjust rate<a class="anchor" aria-label="anchor" href="#adjust-rate"></a>
</h3>
<p>Now we have saved both the background rate and the specimen rate we
can go ahead and adjust. The <code>adjust_rate</code> function has a
<code>method</code> input which determines how the <code>by</code> input
is applied. The default for this is <code>"mean"</code>, and in this
case with a single value will have the same result. However, there is a
specific <code>"value"</code> method to specify single background
values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## adjust rate</span></span>
<span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch</span>, by <span class="op">=</span> <span class="va">bg</span>, method <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'value' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0286</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000765</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0278 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>This same adjustment operation can be conducted by entering numeric
inputs, or a mix of objects and numeric inputs. Care should be taken
when entering values manually to use the correct <em>sign</em> with the
rate. See note <a href="#sign">above</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## adjust rate</span></span>
<span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.0286</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">0.000765</span>, method <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'value' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0286</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000765</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0278 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>The saved <code>urch_adj</code> object has a
<code>$rate.adjusted</code> element which is the rate that will be
converted when it is passed to <code><a href="../reference/convert_rate.html">convert_rate()</a></code> for final
conversion to units.</p>
</div>
</div>
<div class="section level2">
<h2 id="case2">Case 2: Single specimen chamber, multiple rates and a single
control<a class="anchor" aria-label="anchor" href="#case2"></a>
</h2>
<p><em>“We have a single experiment chamber and have extracted multiple
rates from it, and we want to adjust them by a background rate from a
single blank chamber”</em></p>
<p>The same operation as <a href="#case1">Case 1</a> can be performed on
objects containing multiple rates, such as from <code>auto_rate</code>
or where <code>calc_rate</code> has been used to extract multiple rates.
Here we’ll use <code>auto_rate</code> which typically returns several
results. We won’t show the plots this time</p>
<div class="section level3">
<h3 id="calculate-background-and-specimen-rates">Calculate background and specimen rates<a class="anchor" aria-label="anchor" href="#calculate-background-and-specimen-rates"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate background rate using calc_rate.bg</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## inspect and calculate urchin rate using auto_rate and default inputs</span></span>
<span><span class="va">urch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adjust-rates">Adjust rates<a class="anchor" aria-label="anchor" href="#adjust-rates"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## adjust rate</span></span>
<span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch</span>, by <span class="op">=</span> <span class="va">bg</span>, method <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'value' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq density row endrow time endtime  oxy endoxy    rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:  NA    1         7.84  -0.0293 0.992   240.6  25    165  4.0    27.3 7.71   7.03 -0.0293  -0.000765       -0.0285</span></span>
<span><span class="co">#&gt; 2:  NA    2         7.74  -0.0253 0.990   184.5 135    268 22.3    44.5 7.18   6.64 -0.0253  -0.000765       -0.0246</span></span>
<span><span class="co">#&gt; 3:  NA    3         7.86  -0.0324 0.952    15.6   6     54  0.8     8.8 7.82   7.55 -0.0324  -0.000765       -0.0316</span></span>
<span><span class="co">#&gt; 4:  NA    4         7.86  -0.0319 0.958    14.5   8     60  1.2     9.8 7.84   7.56 -0.0319  -0.000765       -0.0312</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note how the single <code>$adjustment</code> value has been applied
to each <code>$rate</code> to give a <code>$rate.adjusted</code>. This
is the rate that will be converted when the object is passed to
<code>convert_rate</code>.</p>
<p>Again, this same operation can be performed using values, if a vector
of rates is passed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## adjust rate</span></span>
<span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.02927</span>, <span class="op">-</span><span class="fl">0.02534</span>, <span class="op">-</span><span class="fl">0.03239</span>, <span class="op">-</span><span class="fl">0.03195</span><span class="op">)</span>, </span>
<span>                        by <span class="op">=</span> <span class="op">-</span><span class="fl">0.000765</span>, </span>
<span>                        method <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'value' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rank    rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:    1 -0.0293  -0.000765       -0.0285</span></span>
<span><span class="co">#&gt; 2:    2 -0.0253  -0.000765       -0.0246</span></span>
<span><span class="co">#&gt; 3:    3 -0.0324  -0.000765       -0.0316</span></span>
<span><span class="co">#&gt; 4:    4 -0.0319  -0.000765       -0.0312</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Obviously in this case there are no regression coefficients or other
data to report.</p>
</div>
</div>
<div class="section level2">
<h2 id="case-3-multiple-specimen-chambers-and-a-single-control">Case 3: Multiple specimen chambers and a single control<a class="anchor" aria-label="anchor" href="#case-3-multiple-specimen-chambers-and-a-single-control"></a>
</h2>
<p><em>“We have multiple specimen chambers and a single control
chamber”</em></p>
<p>The same background rate can be used to adjust multiple experimental
chambers. All that needs to be done is save the background rate object
and use it to adjust as many experimental rates as we want.</p>
<p>Here we save the background rate as above, and also calculate rates
from two of the urchins in the <code>urchins.rd</code> dataset.</p>
<div class="section level3">
<h3 id="calculate-background-and-specimen-rates-1">Calculate background and specimen rates<a class="anchor" aria-label="anchor" href="#calculate-background-and-specimen-rates-1"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate background rate</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## inspect and calculate FIRST urchin rate</span></span>
<span><span class="va">urch1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## inspect and calculate SECOND urchin rate</span></span>
<span><span class="va">urch2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adjust-rates-1">Adjust rates<a class="anchor" aria-label="anchor" href="#adjust-rates-1"></a>
</h3>
<p>Now we can use the <code>bg</code> object to adjust both specimen
rates. As separate objects we have to do this in two operations.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## adjust rate</span></span>
<span><span class="va">urch1_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch1</span>, by <span class="op">=</span> <span class="va">bg</span><span class="op">)</span></span>
<span><span class="va">urch2_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch2</span>, by <span class="op">=</span> <span class="va">bg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0278</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000765</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0271 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0206</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000765</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0198 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
<p>Of course, it is possible to perform this same adjustment for both
specimens in one operation by using a vector of values for the two
specimen rates.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.0278</span>, <span class="op">-</span><span class="fl">0.0206</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">bg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'mean' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rank    rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:    1 -0.0278  -0.000765       -0.0270</span></span>
<span><span class="co">#&gt; 2:    2 -0.0206  -0.000765       -0.0198</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note, we haven’t specified a <code>method</code> in this example. The
default method is <code>"mean"</code> which averages all the background
rates in <code>by</code> (see next example). With only one background
rate, this will obviously have the same result.</p>
</div>
</div>
<div class="section level2">
<h2 id="multicontrols">Case 4: Multiple controls<a class="anchor" aria-label="anchor" href="#multicontrols"></a>
</h2>
<p><em>“We run many experiments in parallel and use empty chambers as
controls when available. We want to use a mean background adjustment
value based on multiple control chambers”</em></p>
<p>Sometimes multiple background controls are run alongside specimen
experiments, or as a block of control experiments in the downtime
between specimen experiments. It is also quite common to have multiple
chambers set up to run in parallel, and when some are not being used for
specimens, rather than have them switched off they are run empty as
controls. In these cases we may want to apply the average background
rate from several chambers as the adjustment value. This can increase
the robustness of background estimations, by averaging out any
variations between chambers, although it is always a good idea to
examine the control data carefully for consistency.</p>
<p>In the <code>urchins.rd</code> data, there are two control chambers
in columns 18 and 19. We will calculate a mean background rate from
these and use this to adjust a specimen rate. We use the
<code>oxygen</code> column identifier input to select multiple
background columns via regular R syntax.</p>
<div class="section level3">
<h3 id="calculate-background-rates">Calculate background rates<a class="anchor" aria-label="anchor" href="#calculate-background-rates"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate background rate from two chambers</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-15-1.png" width="960" style="display: block; margin: auto;"></p>
<p>By default, <code>calc_rate.bg</code> will plot all the calculated
background columns (though you can use the <code>pos</code> input to
select which). If we print the result we can see both calculated
background rates, and the mean value.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bg</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.000765 -0.000902</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.000833</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-frame-input">Data frame input<a class="anchor" aria-label="anchor" href="#data-frame-input"></a>
</h3>
<p>Again, note that using <code><a href="../reference/inspect.html">inspect()</a></code> to prepare data, while
we strongly recommend it (see <code><a href="../articles/inspecting.html">vignette("inspecting")</a></code>), is
optional. <code>calc_rate.bg</code> will also accept a
<code>data.frame</code> directly, and has its own column identifier
inputs. This code will perform exactly the same rate calculation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## inspect and calculate background rate from two chambers</span></span>
<span><span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">:</span><span class="fl">19</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.000765 -0.000902</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.000833</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="background-data-structure">Background data structure<a class="anchor" aria-label="anchor" href="#background-data-structure"></a>
</h3>
<p>In the above example the background data are in the same data frame
and share a <code>time</code> column. What if they are not? What if the
controls are separate datasets of different lengths?</p>
<p>These data are from a separate briefer background experiment - note
the times on the x-axis; these are ~30 minutes as opposed to ~40 for the
two above. We want to use them with the two above to apply a mean
adjustment value based on all five controls.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="va">bg_exp</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-19-1.png" width="960" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.000805 -0.000774 -0.000832</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.000804</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
<p>Note the default behaviour of <code>calc_rate.bg</code> when no other
inputs are provided is to use all columns, assuming column 1 is
<code>time</code> and all other columns are <code>oxygen</code>
data.</p>
</div>
<div class="section level3">
<h3 id="adjust-using-multiple-background-rates">Adjust using multiple background rates<a class="anchor" aria-label="anchor" href="#adjust-using-multiple-background-rates"></a>
</h3>
<p>To calculate a mean background rate across different datasets in one
<code>calc_rate.bg</code> command they would have to be in the same data
frame and share the same time column. It is of course possible in R to
put them into this form. Even if they are different lengths, you could
fill empty rows with <code>NA</code>, and this would not affect
calculated rates, as they are derived from linear models which simply
ignore <code>NA</code> values.</p>
<p>However, there are easier approaches to accomplish the same thing. We
have saved two background objects (<code>bg</code>, <code>bg2</code>),
one with two rates, one with three. We could calculate the mean rate
ourselves and enter it as a single adjustment value. We’ll adjust one of
the specimen rates we calculated above.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.000765</span>, <span class="op">-</span><span class="fl">0.000902</span>, <span class="op">-</span><span class="fl">0.000805</span>, <span class="op">-</span><span class="fl">0.000774</span>, <span class="op">-</span><span class="fl">0.000832</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch1</span>, by <span class="op">=</span> <span class="va">adj</span>, method <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'value' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0278</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000816</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.027 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Or alternatively, enter the five background rates directly as a
numeric vector and let the default <code>method = "mean"</code> be
applied.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch1</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.000765</span>, <span class="op">-</span><span class="fl">0.000902</span>, <span class="op">-</span><span class="fl">0.000805</span>, <span class="op">-</span><span class="fl">0.000774</span>, <span class="op">-</span><span class="fl">0.000832</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0278</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000816</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.027 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Or we could use the object names and extract the
<code>$rate.bg</code> element directly while combining to a vector.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch1</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg</span><span class="op">$</span><span class="va">rate.bg</span>,</span>
<span>                          <span class="va">bg2</span><span class="op">$</span><span class="va">rate.bg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0278</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000816</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.027 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>The fact that <code>adjust_rate</code> (as well as most
<code>respR</code> functions) accepts numeric values, vectors and other
data structures means there can be many approaches to accomplish the
same result.</p>
</div>
</div>
<div class="section level2">
<h2 id="case-5-paired-controls">Case 5: Paired controls<a class="anchor" aria-label="anchor" href="#case-5-paired-controls"></a>
</h2>
<p><em>“We are running multiple chambers, each with its own paired
control chamber.”</em></p>
<p>Some multiple chamber experiments are set up like this, with each
specimen chamber having its own specific control. As seen in the
examples above (such as <a href="#case1">Case 1</a>), these are
relatively easy to handle on an individual basis.</p>
<p>However, if you have extracted rates from the chambers and their
controls, these can be used in <code>adjust_rate</code> using
<code>method = "paired"</code> so that each specimen rate is adjusted by
the background rate in the same position.</p>
<div class="section level3">
<h3 id="calculate-specimen-and-background-rates">Calculate specimen and background rates<a class="anchor" aria-label="anchor" href="#calculate-specimen-and-background-rates"></a>
</h3>
<p>Again, we’ll use the <code>urchins.rd</code> dataset, and we will
assume that the two background columns (18 &amp; 19) are paired with the
first two specimen columns (2 &amp; 3), that is 2 will be adjusted by
18, and 3 adjusted by 19.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate both background rates</span></span>
<span><span class="va">bg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">19</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Calculate both urchin rates</span></span>
<span><span class="va">urch1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">urch2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<p>We’ll print the values for a quick look.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urch1</span><span class="op">$</span><span class="va">rate</span></span>
<span><span class="co">#&gt; [1] -0.0271</span></span>
<span><span class="va">urch2</span><span class="op">$</span><span class="va">rate</span></span>
<span><span class="co">#&gt; [1] -0.0195</span></span>
<span><span class="va">bg1</span><span class="op">$</span><span class="va">rate.bg</span></span>
<span><span class="co">#&gt; [1] -0.000765</span></span>
<span><span class="va">bg2</span><span class="op">$</span><span class="va">rate.bg</span></span>
<span><span class="co">#&gt; [1] -0.000902</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adjust-rates---numeric-inputs">Adjust rates - numeric inputs<a class="anchor" aria-label="anchor" href="#adjust-rates---numeric-inputs"></a>
</h3>
<p>For the <code>"paired"</code> method, it is generally easiest to
enter the rates as numerics. Here we can extract them directly from the
objects using <code>$</code> and combine them to a vector using
<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">urch1</span><span class="op">$</span><span class="va">rate</span>, <span class="va">urch2</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>                        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg1</span><span class="op">$</span><span class="va">rate.bg</span>, <span class="va">bg2</span><span class="op">$</span><span class="va">rate.bg</span><span class="op">)</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"paired"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'paired' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rank    rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:    1 -0.0271  -0.000765       -0.0264</span></span>
<span><span class="co">#&gt; 2:    2 -0.0195  -0.000902       -0.0186</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>We can see each specimen rate has been adjusted by the background
rate at the same position in <code>by</code>.</p>
</div>
<div class="section level3">
<h3 id="adjust-rates---calc_rate-bg-object-input">Adjust rates - <code>calc_rate.bg</code> object input<a class="anchor" aria-label="anchor" href="#adjust-rates---calc_rate-bg-object-input"></a>
</h3>
<p>The <code>"paired"</code> method will however also work with a
<code>calc_rate.bg</code> object, as long as it contains the correct
number of rates. We can repeat the above example but use
<code>calc_rate.bg</code> to extract the rates from both background
columns.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate both background rates</span></span>
<span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Adjust specimen rates (as calculated above)</span></span>
<span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">urch1</span><span class="op">$</span><span class="va">rate</span>, <span class="va">urch2</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span>,</span>
<span>                        by <span class="op">=</span> <span class="va">bg</span>, <span class="co"># bg object instead of values</span></span>
<span>                        method <span class="op">=</span> <span class="st">"paired"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'paired' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rank    rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:    1 -0.0271  -0.000765       -0.0264</span></span>
<span><span class="co">#&gt; 2:    2 -0.0195  -0.000902       -0.0186</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>We can see this is the same result as above.</p>
<p>Note, this works for <code>calc_rate.bg</code> because it was
designed to extract single rates from multiple oxygen columns. It won’t
for <code>calc_rate</code> because it was designed to extract multiple
(i.e. 1 or more) rates from a single oxygen column. See next example
however.</p>
</div>
<div class="section level3">
<h3 id="adjust-rates---calc_rate-object-input">Adjust rates - <code>calc_rate</code> object input<a class="anchor" aria-label="anchor" href="#adjust-rates---calc_rate-object-input"></a>
</h3>
<p>The <code>"paired"</code> method will work with a single
<code>calc_rate</code> (or <code>auto_rate</code>) output object
containing multiple rates, as long as the <code>by</code> input contains
the same number of rates. Use cases for this are quite narrow, but it
could be used to extract rates from the same regions of specimen and
background experiments, so that rates are adjusted using a background
from the same time in the experiment. This particular use case is
covered under the <code>"concurrent"</code> method in the <a href="#concurrent">next section</a>, but this example shows it does work
as expected.</p>
<p>We’ll use <code>urchins.rd</code> column 2 and its paired background
column 18 to extract three rates from different, though overlapping,
twenty minute regions.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Set from and to times</span></span>
<span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span> </span>
<span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Extract three background rates</span></span>
<span><span class="va">bg1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">urchins.rd</span>, from <span class="op">=</span> <span class="va">from</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bg2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">urchins.rd</span>, from <span class="op">=</span> <span class="va">from</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bg3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">urchins.rd</span>, from <span class="op">=</span> <span class="va">from</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate specimen rates </span></span>
<span><span class="va">urch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">from</span>, to <span class="op">=</span> <span class="va">to</span><span class="op">)</span></span></code></pre></div>
<p>Now we have three background rates, and three specimen rates all from
the same respective regions. We’ll print for a quick look.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bg1</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1    rsq row endrow time endtime oxy endoxy  rate.bg</span></span>
<span><span class="co">#&gt; 1:  NA    1          7.9 -0.00031 0.0108   1    121    0      20 7.9   7.89 -0.00031</span></span>
<span><span class="va">bg2</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;    rep rank intercept_b0  slope_b1    rsq row endrow time endtime oxy endoxy   rate.bg</span></span>
<span><span class="co">#&gt; 1:  NA    1         7.91 -0.000912 0.0817   1    121   10      30 7.9   7.84 -0.000912</span></span>
<span><span class="va">bg3</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq row endrow time endtime  oxy endoxy  rate.bg</span></span>
<span><span class="co">#&gt; 1:  NA    1         7.92 -0.00117 0.139   1    121   20      40 7.89   7.89 -0.00117</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.calc_rate # -------------------</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq row endrow time endtime  oxy endoxy rate.2pt    rate</span></span>
<span><span class="co">#&gt; 1:  NA    1         7.85  -0.0303 0.988   1    121    0      20 7.86   7.31  -0.0275 -0.0303</span></span>
<span><span class="co">#&gt; 2:  NA    2         7.83  -0.0286 0.987  61    181   10      30 7.58   7.00  -0.0290 -0.0286</span></span>
<span><span class="co">#&gt; 3:  NA    3         7.76  -0.0257 0.984 121    241   20      40 7.31   6.72  -0.0295 -0.0257</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note how the background rates vary quite a lot. This is because they
have been determined over short timescales, and is a good example of why
background experiments should be conducted over durations long enough to
provide good estimations of the rate of oxygen decline or increase. This
is because the signal to noise ratio of shallow background oxygen use or
production is often low, so slopes fit over short timescales will have a
lot of residual variation, and be inherently less accurate. However, for
the purposes of this example we’ll proceed and use them to adjust the
specimen rates.</p>
<p>Here, we adjust the <code>calc_rate</code> object which contains
three rates with a vector of the background rates.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urch_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch</span>,</span>
<span>                        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg1</span><span class="op">$</span><span class="va">rate.bg</span>, <span class="va">bg2</span><span class="op">$</span><span class="va">rate.bg</span>, <span class="va">bg3</span><span class="op">$</span><span class="va">rate.bg</span><span class="op">)</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"paired"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">urch_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'paired' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq row endrow time endtime  oxy endoxy rate.2pt    rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:  NA    1         7.85  -0.0303 0.988   1    121    0      20 7.86   7.31  -0.0275 -0.0303  -0.000310       -0.0300</span></span>
<span><span class="co">#&gt; 2:  NA    2         7.83  -0.0286 0.987  61    181   10      30 7.58   7.00  -0.0290 -0.0286  -0.000912       -0.0277</span></span>
<span><span class="co">#&gt; 3:  NA    3         7.76  -0.0257 0.984 121    241   20      40 7.31   6.72  -0.0295 -0.0257  -0.001168       -0.0246</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Again each specimen rate has been adjusted by the background rate at
the same position.</p>
</div>
</div>
<div class="section level2">
<h2 id="concurrent">Case 6: Concurrent controls<a class="anchor" aria-label="anchor" href="#concurrent"></a>
</h2>
<p><em>“Our background rate may increase, decrease or fluctuate. We want
to adjust the specimen rate by the background rate determined over the
exact same time period in a concurrently run blank chamber.”</em></p>
<p>This is very similar to the last example in the previous section. In
fact, this is exactly the same concept, but the
<code>"concurrent"</code> method allows the appropriate background rate
to be automatically extracted from the same time window in the
background data as the rate to be adjusted.</p>
<p>This is for experiments where one or more controls have been run
concurrently alongside specimen chambers. Therefore the data must either
be contained in the same dataset (e.g. as in <code>urchins.rd</code>),
or if in a separate dataset must share broadly the same time data, or at
least have an equivalent starting time, as well as the same units of
time and oxygen.</p>
<p>If background and specimen datasets are separate they do not need to
be exactly the same length. There is some leeway to this built in; if
they differ in length by more than 5% or some time values are not shared
between the two datasets, a warning is given, but the adjustment is
nevertheless performed using the available data, by using the closest
matching time window in the background data.</p>
<p>To repeat the note from the example above, estimating background
rates over the short durations specimen rates are often determined over
may not always be appropriate or accurate. This is because the signal to
noise ratio of shallow background oxygen use or production is often low,
so slopes fit over short timescales will have a lot of residual
variation, and be inherently less accurate. Background rates should be
calculated over durations long enough to provide good estimations of the
true rate of oxygen decline or increase. If background data are noisy or
trends are unclear, <a href="#dynlinear">dynamic adjustments</a> may be
a more appropriate way to get background rate estimations and will work
with any two reliable sections of data of any length. See later
sections.</p>
<div class="section level3">
<h3 id="explanation">Explanation<a class="anchor" aria-label="anchor" href="#explanation"></a>
</h3>
<p>This method will not accept numeric inputs. The
<code>"concurrent"</code> method is fairly straightforward. Given a
<code>calc_rate</code>, <code>calc_rate.int</code>,
<code>auto_rate</code>, or <code>auto_rate.int</code> object as input,
for each rate contained in it, <code>adjust_rate</code> uses the
regression parameters from the <code>$summary</code> table to fit a
regression over the same region in the background data entered as the
<code>by</code> input, the slope of which is the background rate. The
<code>by</code> input can be a <code>data.frame</code>,
<code>inspect</code>, <code>calc_rate.bg</code>, or
<code>calc_rate</code> object. If one of the latter three, the function
uses only the <code>$dataframe</code> element. If there is more than one
column of oxygen in the background data, the function calculates the
background rate across the same region in <em>all</em> columns, and the
mean of these are applied as the adjustment. Therefore, concurrent rates
from single or multiple controls can be used to adjust specimen
rates.</p>
</div>
<div class="section level3">
<h3 id="case6eg1">Example 1 - Closed chamber respirometry<a class="anchor" aria-label="anchor" href="#case6eg1"></a>
</h3>
<p>This example (using the initial part of the <code>squid.rd</code>
data) is a closed chamber respirometry experiment on a squid.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqd_insp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">sqd</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-34-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="section level4">
<h4 id="prepare-background-data">Prepare background data<a class="anchor" aria-label="anchor" href="#prepare-background-data"></a>
</h4>
<p>The background data is in a separate data frame, <code>sqd_bg</code>.
There is no need to calculate a rate; <code>adjust_rate</code> will do
this when it identifies the relevant data regions (although it will
accept <code>calc_rate.bg</code> objects). We could also use a data
frame as the <code>by</code> input. The only requirement is that the
time is in column 1 and all other columns are the oxygen columns you
want to use to calculate the concurrent background rate. However it’s
always a good idea to inspect the data for issues and visualise it using
<code>inspect</code>, and this function also allows us to extract the
columns we are interested in.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqd_bg_insp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">sqd_bg</span>, time <span class="op">=</span> <span class="fl">1</span>, oxygen <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-35-1.png" width="960" style="display: block; margin: auto;"></p>
<p>The rolling rate plot makes clear that the background rate increases
over the duration of the experiment. Estimating the background rate
using the whole dataset would therefore likely lead to a wrong
estimation, depending on the time the specimen rate is extracted from.
More localised estimations would therefore be more representative.</p>
</div>
<div class="section level4">
<h4 id="calculate-specimen-rate-1">Calculate specimen rate<a class="anchor" aria-label="anchor" href="#calculate-specimen-rate-1"></a>
</h4>
<p>We’ll use <code>auto_rate</code> on the squid data.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqd_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="va">sqd_insp</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-36-1.png" width="960" style="display: block; margin: auto;"></p>
<p>There are 22 linear regions found in these data, so we have 22 rates
to be adjusted.</p>
</div>
<div class="section level4">
<h4 id="adjust-rates-2">Adjust rates<a class="anchor" aria-label="anchor" href="#adjust-rates-2"></a>
</h4>
<p>All we need to do is enter the background <code>inspect</code> object
as the <code>by</code> input and specify the method.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqd_ar_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">sqd_ar</span>, by <span class="op">=</span> <span class="va">sqd_bg_insp</span>, method <span class="op">=</span> <span class="st">"concurrent"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll look at the top 5 rows of the summary table.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sqd_ar_adj</span>, pos <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'concurrent' method.</span></span>
<span><span class="co">#&gt; Summary of rate results from entered 'pos' rank(s):</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0  slope_b1   rsq density  row endrow time endtime  oxy endoxy      rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:  NA    1         7.77 -0.000322 0.999  128161 2425   4800 2424    4799 6.97   6.23 -0.000322 -0.0000296     -0.000293</span></span>
<span><span class="co">#&gt; 2:  NA    2         7.75 -0.000316 0.999   68103  274   3058  273    3057 7.67   6.80 -0.000316 -0.0000156     -0.000300</span></span>
<span><span class="co">#&gt; 3:  NA    3         7.76 -0.000322 0.998   64343 3111   4466 3110    4465 6.76   6.33 -0.000322 -0.0000310     -0.000291</span></span>
<span><span class="co">#&gt; 4:  NA    4         7.77 -0.000322 0.999   56371 2424   4810 2423    4809 6.97   6.21 -0.000322 -0.0000296     -0.000293</span></span>
<span><span class="co">#&gt; 5:  NA    5         7.74 -0.000312 0.998   43275 1556   3060 1555    3059 7.26   6.78 -0.000312 -0.0000189     -0.000293</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note how the adjustment value differs. The top two adjustments are a
good example of what we would expect concurrently calculated background
rates to be, given what we saw when we inspected the background data,
and that the background rate increases with time. The second row
adjustment, which comes from the start of the dataset, is much lower
than the first row adjustment, which comes from around the middle of the
dataset.</p>
<p>We can use <code>calc_rate.bg</code> and the row numbers from the
summary to show that the adjustments for these have been calculated
correctly.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">sqd_bg</span>, from <span class="op">=</span> <span class="fl">2425</span>, to <span class="op">=</span> <span class="fl">4800</span>, by <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-39-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">sqd_bg</span>, from <span class="op">=</span> <span class="fl">273</span>, to <span class="op">=</span> <span class="fl">3057</span>, by <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-39-2.png" width="960" style="display: block; margin: auto;"></p>
<p>We can see the slopes in the equations are identical to the
adjustment values in the summary.</p>
<p>The <code>"concurrent"</code> method is ideal for this type of
dynamic adjustment, however requires a complete concurrent recording of
a control experiment. See <a href="#linear">linear</a> and <a href="#dynexpon">exponential</a> dynamic adjustment sections for
examples of applying dynamic adjustments when a complete control
recording is not available.</p>
</div>
</div>
<div class="section level3">
<h3 id="example-2---intermittent-flow-respirometry">Example 2 - Intermittent-flow respirometry<a class="anchor" aria-label="anchor" href="#example-2---intermittent-flow-respirometry"></a>
</h3>
<p>In this example, a concurrent control has been run alongside an
intermittent-flow experiment, and been flushed at the same time as the
specimen chamber. In this plot the specimen data is in black, the
control in orange.</p>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-40-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Clearly, fitting slopes to any part of the background data other than
within each replicate will lead to questionable results. Since we will
be calculating a specimen rate within each replicate, the concurrent
method can also use these locations to calculate a background rate.</p>
<div class="section level4">
<h4 id="extract-rates">Extract rates<a class="anchor" aria-label="anchor" href="#extract-rates"></a>
</h4>
<p>The replicates follow a specific cycle of 9 minutes closed, two
minutes flushing. Knowing this, we can use <code>calc_rate.int</code> to
extract a rate from the same time window within each using the
<code>wait</code> and <code>measure</code> inputs. We use a
<code>wait</code> of five minutes (300 rows) at the start of each, which
excludes the flush and start of the replicate data. We then use a
<code>measure</code> phase of six minutes (360 rows) to extract a rate
from the rest of the replicate.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># replicate start times - seq(from, to, by)</span></span>
<span><span class="co"># starts &lt;- seq(120, 2100, 660) </span></span>
<span><span class="co"># # three minute buffer of data to exclude at the start of each replicate</span></span>
<span><span class="co"># buffer &lt;- 180 </span></span>
<span><span class="co"># # period to measure after buffer</span></span>
<span><span class="co"># measure &lt;- 360</span></span>
<span></span>
<span><span class="va">rates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_rate.int.html">calc_rate.int</a></span><span class="op">(</span><span class="va">interm_insp</span>,</span>
<span>                       starts <span class="op">=</span> <span class="fl">660</span>,</span>
<span>                       wait <span class="op">=</span> <span class="fl">180</span>,</span>
<span>                       measure <span class="op">=</span> <span class="fl">420</span>,</span>
<span>                       by <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-41-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rates</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.calc_rate.int # ---------------</span></span>
<span><span class="co">#&gt; Summary of all replicate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq  row endrow time endtime  oxy endoxy rate.2pt     rate</span></span>
<span><span class="co">#&gt; 1:   1    1         8.27 -0.00223 0.983  181    600  181     600 7.88   6.96 -0.00221 -0.00223</span></span>
<span><span class="co">#&gt; 2:   2    1         9.80 -0.00228 0.979  841   1260  841    1260 7.89   7.02 -0.00208 -0.00228</span></span>
<span><span class="co">#&gt; 3:   3    1        11.25 -0.00224 0.981 1501   1920 1501    1920 8.00   6.96 -0.00248 -0.00224</span></span>
<span><span class="co">#&gt; 4:   4    1        12.81 -0.00227 0.979 2161   2580 2161    2580 7.91   6.97 -0.00225 -0.00227</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adjust-rates-3">Adjust rates<a class="anchor" aria-label="anchor" href="#adjust-rates-3"></a>
</h4>
<p>Now we have a rate from each replicate, we can adjust them using the
<code>"concurrent"</code> method, and the background dataset.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">rates</span>,</span>
<span>                   <span class="va">interm_bg</span>,</span>
<span>                   <span class="st">"concurrent"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'concurrent' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq  row endrow time endtime  oxy endoxy rate.2pt     rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:   1    1         8.27 -0.00223 0.983  181    600  181     600 7.88   6.96 -0.00221 -0.00223  -0.000466      -0.00177</span></span>
<span><span class="co">#&gt; 2:   2    1         9.80 -0.00228 0.979  841   1260  841    1260 7.89   7.02 -0.00208 -0.00228  -0.000453      -0.00182</span></span>
<span><span class="co">#&gt; 3:   3    1        11.25 -0.00224 0.981 1501   1920 1501    1920 8.00   6.96 -0.00248 -0.00224  -0.000447      -0.00180</span></span>
<span><span class="co">#&gt; 4:   4    1        12.81 -0.00227 0.979 2161   2580 2161    2580 7.91   6.97 -0.00225 -0.00227  -0.000460      -0.00181</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>A background adjustment has been calculated from the same time window
in the background data for each replicate. We can see they are very
consistent, as are the adjusted specimen rates, so all looks good.</p>
<p>If you want to check the adjustment is correct, and that the times
used match those of each rate, these are found in the
<code>$adjustment_model</code> element of the output object.</p>
</div>
</div>
<div class="section level3">
<h3 id="example-3---multiple-concurrent-controls">Example 3 - Multiple concurrent controls<a class="anchor" aria-label="anchor" href="#example-3---multiple-concurrent-controls"></a>
</h3>
<p>Much as in how a mean background rate from multiple controls can be
used to adjust one or more specimen rates (see <a href="#multicontrols">here</a>), rates can be extracted from the same
time window of multiple concurrent controls to determine a mean
background rate.</p>
<p>The <code>urchins.rd</code> data contains two columns of background
data in columns 18 and 19. We’ll calculate a specimen rate from a
specific time window, and use the two background columns to get a mean
background rate from the same window.</p>
<div class="section level4">
<h4 id="calculate-specimen-rate-2">Calculate specimen rate<a class="anchor" aria-label="anchor" href="#calculate-specimen-rate-2"></a>
</h4>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate specimen rate between 10 and 30 mins</span></span>
<span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, </span>
<span>            to <span class="op">=</span> <span class="fl">30</span>,</span>
<span>            by <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-44-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="inspect-background-data">Inspect background data<a class="anchor" aria-label="anchor" href="#inspect-background-data"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Inspect background columns</span></span>
<span><span class="va">bg_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, </span>
<span>                   time <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                   oxygen <span class="op">=</span> <span class="fl">18</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-45-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="adjust-rate-1">Adjust rate<a class="anchor" aria-label="anchor" href="#adjust-rate-1"></a>
</h4>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">rate</span>,</span>
<span>                        by <span class="op">=</span> <span class="va">bg_data</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"concurrent"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rate_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'concurrent' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0286</span></span>
<span><span class="co">#&gt; Adjustment    : -0.00065</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0279 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>The adjustment value here is the mean of the two background rates
from the same time window of the background columns that the specimen
rate was determined from. We show this is the case in the next
section.</p>
</div>
<div class="section level4">
<h4 id="use-mean-method-instead">Use mean method instead<a class="anchor" aria-label="anchor" href="#use-mean-method-instead"></a>
</h4>
<p>This performs the same adjustment using a different approach, and
again demonstrates that the <code>"concurrent"</code> method results are
as expected.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset background data between same timepoints</span></span>
<span><span class="va">bg_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, <span class="fl">1</span>, <span class="fl">18</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">30</span>, by <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.000912 -0.000388</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.00065</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">rate</span>,</span>
<span>                        by <span class="op">=</span> <span class="va">bg_rate</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rate_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0286</span></span>
<span><span class="co">#&gt; Adjustment    : -0.00065</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0279 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>We can see this is the same result as the example above using the
<code>"concurrent"</code> method. This is a good example of how the
functions in <code>respR</code> are designed to be flexible and
adaptable, and how the same result can be achieved using different
approaches.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="dynlinear">Case 7: Dynamic linear adjustment<a class="anchor" aria-label="anchor" href="#dynlinear"></a>
</h2>
<p><em>“We have background recordings from directly before and after the
experiment and want to apply adjustments assuming the change in
background rate over the experiment was linear”</em></p>
<p>This is common in intermittent-flow respirometry where experiments
are run for long durations, often in relatively high temperatures, and
so the background rate may increase over the course of the experiment.
It is not always practical to run a concurrent empty control in these
experiments, so often the equipment is run empty for a period before the
specimen is inserted, and again afterwards after it has been removed to
provide pre- and post-experiment controls. The typical practice is to
assume any change in background rate between these two timepoints is
linear, that is any increase in background rate over time is monotonic.
Therefore, each specimen rate is adjusted by a different value
calculated using its timepoint within the experiment. We would always
however recommend at least one completely empty control be run to
validate that a linear relationship in background rate is indeed the
case (and see next section - <a href="#dynexpon">exponential
adjustments</a>).</p>
<p>This method can also however be used in experiments in which a
concurrent blank experiment is conducted alongside specimen experiments
(as described in the <a href="#concurrent"><code>concurrent</code></a>
section above), but in which the background data is deemed too noisy to
fit reliable regressions over the short timescales that specimen rates
are determined. In this case, <em>any</em> two reliable segments of the
background data of any duration can be used to determine how the
background rate changes over the course of the experiment, and then this
used to adjust specimen rates using the <code>"linear"</code> or
<code>"exponential"</code> methods.</p>
<div class="section level3">
<h3 id="linnotes">Notes<a class="anchor" aria-label="anchor" href="#linnotes"></a>
</h3>
<p><code>adjust_rate</code> has additional inputs that we have not yet
used that only apply to the <code>"linear"</code> and
<code>"exponential"</code> methods. The one we’ll use in the <a href="#lineareg1">first example</a> is <code>by2</code>. The additional
inputs <code>time_x</code>, <code>time_by</code>, and
<code>time_by2</code> are used for numeric inputs, as shown in the <a href="#lineareg2">next example</a>.</p>
<p>In the <code>"linear"</code> and <code>"exponential"</code> methods,
the <code>by</code> input is the earlier background rate,
<code>by2</code> is the later background rate. These should share the
same numeric time units and scale, that is the numeric time values
should represent the time difference between them; see the plots below
in <a href="#lineareg1">Example 1</a> of the two background rates and
note the blue time x-axes (note that because the data are subsets of a
larger dataset, the red row axes do not correspond).</p>
<p>The rate to be adjusted should also be on the same time scale.
Ideally, as in this example, within the same dataset, but they do not
have to be. As long as the numeric time values represent the same
relative time scale, they can be separate datasets. In fact, if after
several experiments you find the background rate relationship to be
highly consistent, the same values could be used to adjust future
experiments. Care just needs to be taken to have the experimental data
time scale be consistent with the controls. Typically that would mean
having a consistent start time, that of the end time value of the first
control dataset.</p>
<p>Note that the rates to be adjusted using the <code>"linear"</code>
and <code>"exponential"</code> methods do not necessarily have to be at
intermediate times to the background data. Once <code>adjust_rate</code>
has calculated the formula describing the change in background rate
against time, it can apply this to calculate an adjustment for rates at
<em>any</em> time on the same scale, including before and after the
times of the background rates. This is probably not ideal practice, but
the function does make it possible.</p>
</div>
<div class="section level3">
<h3 id="dynexplan">Explanation<a class="anchor" aria-label="anchor" href="#dynexplan"></a>
</h3>
<p><code>adjust_rate</code> takes the two background rate values in
<code>by</code> and <code>by2</code> and the midpoint of the time
windows over which they were determined and calculates a linear
relationship of rate against time:
<code>lm(c(rate1, rate2)) ~ c(time1, time2))</code>. For each rate in
<code>x</code> to be adjusted, it extracts the midpoint of the time
window it was calculated over and uses the slope and intercept from the
linear model to calculate an adjustment value.</p>
<p>This explanation also applies to the <code>"exponential"</code>
method, except the adjustment is calculated as an exponential
relationship of the form -
<code>lm(log(c(rate1, rate2)) ~ c(time1, time2))</code>.</p>
</div>
<div class="section level3">
<h3 id="experiment-overview">Experiment overview<a class="anchor" aria-label="anchor" href="#experiment-overview"></a>
</h3>
<p>The <code>zeb_intermittent.rd</code> dataset is from an experiment on
a zebrafish. It is comprised of over 100 replicates. See
<code><a href="../reference/zeb_intermittent.rd.html">help(zeb_intermittent.rd)</a></code> for more details. See
<code><a href="../articles/intermittent_long.html">vignette("intermittent_long")</a></code> for a more detailed example
of analysing this experiment, but we will briefly repeat part of it
here. We will extract rates from one replicate in the middle of the
experiment, and using the pre- and post-experiment control sections
adjust it using the <code>"linear"</code> method in
<code>adjust_rate</code>.</p>
</div>
<div class="section level3">
<h3 id="lineareg1">Example 1: Object inputs<a class="anchor" aria-label="anchor" href="#lineareg1"></a>
</h3>
<p>In this example the rate and background inputs to adjust_rate will be
<code>respR</code> objects, that is outputs from
<code>calc_rate.bg</code> and <code>auto_rate</code>. In the <a href="#eg2numeric">next example</a> we’ll do the same adjustment using
numeric inputs.</p>
<div class="section level4">
<h4 id="extract-and-calculate-background-rates">Extract and calculate background rates<a class="anchor" aria-label="anchor" href="#extract-and-calculate-background-rates"></a>
</h4>
<p>The first replicate up to timepoint 4999 is the pre-experiment
background data, and from timepoints 75140 to 79251 the post-experiment
background data. We’ll subset both of these and calculate the pre- and
post-experiment background rates.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pre</span></span>
<span><span class="va">bg_pre</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">zeb_intermittent.rd</span>, <span class="fl">1</span>, <span class="fl">4999</span>, <span class="st">"time"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-50-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># post</span></span>
<span><span class="va">bg_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">zeb_intermittent.rd</span>, <span class="fl">75140</span>, <span class="fl">79251</span>, <span class="st">"time"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-50-2.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bg_pre</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.0000742</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.0000742</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bg_post</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.0001217</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.0001217</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>We can see the background rate increases by around 70% over the
course of the experiment. These objects are saved, so now we’ll
calculate the rate from a replicate in the middle of the dataset.</p>
</div>
<div class="section level4">
<h4 id="calculate-specimen-rate-3">Calculate specimen rate<a class="anchor" aria-label="anchor" href="#calculate-specimen-rate-3"></a>
</h4>
<p>This replicate occurs roughly half way through the experiment. Like
above, we’ll subset out the replicate. We’ll also apply a ‘wait’ phase
of 2 minutes (120s) from the start that we don’t want to use in the
analysis, and a ‘measure’ phase of 7 minutes (420s) to exclude the 2
minutes of flushing at the end.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define rep start time, buffer and measure periods</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">38180</span> <span class="co"># start time of replicate</span></span>
<span><span class="va">wait</span> <span class="op">&lt;-</span> <span class="fl">120</span>   <span class="co"># 2 mins buffer</span></span>
<span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fl">420</span>  <span class="co"># 7 mins measure</span></span>
<span></span>
<span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">zeb_intermittent.rd</span>, </span>
<span>                    from <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="va">wait</span>, </span>
<span>                    to <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="va">wait</span> <span class="op">+</span> <span class="va">measure</span>, </span>
<span>                    by <span class="op">=</span> <span class="st">"time"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/auto_rate.html">auto_rate</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-53-1.png" width="960" style="display: block; margin: auto;"></p>
<p><code>auto_rate</code> has identified three linear regions.</p>
</div>
<div class="section level4">
<h4 id="adjust-rates-4">Adjust rates<a class="anchor" aria-label="anchor" href="#adjust-rates-4"></a>
</h4>
<p>Now we’ll adjust the specimen rates using the two background rates
and the <code>"linear"</code> method.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">rate</span>,</span>
<span>                        by <span class="op">=</span> <span class="va">bg_pre</span>,</span>
<span>                        by2 <span class="op">=</span> <span class="va">bg_post</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rate_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'linear' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq density row endrow  time endtime  oxy endoxy     rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:  NA    1         81.0 -0.00191 0.909    1264 218    398 38517   38697 7.28   6.98 -0.00191 -0.0000971      -0.00182</span></span>
<span><span class="co">#&gt; 2:  NA    2         90.8 -0.00217 0.978     967   4    375 38303   38674 7.80   6.97 -0.00217 -0.0000971      -0.00207</span></span>
<span><span class="co">#&gt; 3:  NA    3        119.6 -0.00292 0.823     421  47    132 38346   38431 7.69   7.46 -0.00292 -0.0000970      -0.00282</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note the adjustment values are very close though not identical in
value, and they are roughly numerically midway between the pre- and
post-experiment background rates of <code>-0.0000742</code> and
<code>-0.0001217</code>. This is what we would expect for a replicate in
the middle of the dataset if the background rate was increasing linearly
between these two values.</p>
<p>We can show this using the background times and rates by creating our
own linear model, and using the coefficients to calculate the rate for a
given time, that of the first result in the summary table above.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## background rates and midpoint times</span></span>
<span><span class="va">bg1_rt</span> <span class="op">&lt;-</span> <span class="va">bg_pre</span><span class="op">$</span><span class="va">rate.bg</span></span>
<span><span class="va">bg2_rt</span> <span class="op">&lt;-</span> <span class="va">bg_post</span><span class="op">$</span><span class="va">rate.bg</span></span>
<span><span class="va">bg1_tm</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">4999</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span><span class="va">bg2_tm</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">75140</span> <span class="op">+</span> <span class="fl">79251</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span></span>
<span><span class="co">## extract slope and intercept</span></span>
<span><span class="va">bg_lm_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg1_rt</span>, <span class="va">bg2_rt</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg1_tm</span>, <span class="va">bg2_tm</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">bg_lm_slp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg1_rt</span>, <span class="va">bg2_rt</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bg1_tm</span>, <span class="va">bg2_tm</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## midpoint time of the first rate in summary</span></span>
<span><span class="va">rate_time</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">rate</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">rate</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">endtime</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span></span>
<span><span class="co">## Background rate </span></span>
<span><span class="va">rate_time</span> <span class="op">*</span> <span class="va">bg_lm_slp</span> <span class="op">+</span> <span class="va">bg_lm_int</span></span>
<span><span class="co">#&gt; [1] -0.0000971</span></span></code></pre></div>
<p>This is the same as the adjustment value in the summary above.</p>
</div>
</div>
<div class="section level3">
<h3 id="lineareg2">Example 2: Numeric inputs<a class="anchor" aria-label="anchor" href="#lineareg2"></a>
</h3>
<p>The exact same adjustment as the above example can be performed by
entering numeric values. Because the <code>x</code>, <code>by</code>,
and <code>by2</code> are not objects, and therefore do not contain
associated timestamps, these must be entered as <code>time_x</code>,
<code>time_by</code>, and <code>time_by2</code>.</p>
<p>We won’t repeat the whole analysis, only enter the appropriate values
as numerics in <code>adjust_rate</code> to show they output the same
result. Here we enter the rates, and the <em>midpoints</em> of the time
ranges over which they were determined.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.00191</span>, <span class="op">-</span><span class="fl">0.00217</span>, <span class="op">-</span><span class="fl">0.00292</span><span class="op">)</span>,</span>
<span>                        by <span class="op">=</span> <span class="op">-</span><span class="fl">0.0000742</span>,</span>
<span>                        by2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0001217</span>,</span>
<span>                        time_x <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">38517</span>, <span class="fl">38303</span>, <span class="fl">38346</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">38697</span>, <span class="fl">38674</span>, <span class="fl">38431</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                        time_by <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">4999</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                        time_by2 <span class="op">=</span> <span class="op">(</span><span class="fl">75140</span> <span class="op">+</span> <span class="fl">79251</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rate_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'linear' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rank     rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:    1 -0.00191 -0.0000972      -0.00181</span></span>
<span><span class="co">#&gt; 2:    2 -0.00217 -0.0000971      -0.00207</span></span>
<span><span class="co">#&gt; 3:    3 -0.00292 -0.0000970      -0.00282</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>We get the same result as above (the small mismatch in the first is
simply due to the lower precision of entered values compared to internal
ones).</p>
</div>
</div>
<div class="section level2">
<h2 id="dynexpon">Case 8: Dynamic exponential adjustment<a class="anchor" aria-label="anchor" href="#dynexpon"></a>
</h2>
<p><em>“We have background recordings from directly before and after the
experiment and want to apply adjustments assuming the change in
background rate over the experiment was
<strong>exponential</strong>”</em></p>
<p>This is exactly the same as the <a href="#dynlinear">dynamic
linear</a> adjustment above, except the background rate is assumed to
increase exponentially. The explanation and background to this is
covered <a href="#linnotes">above</a>, so please read that first.</p>
<p>An exponential increase in background rate is quite common in
experiments done at high temperatures, where the microbial population in
a respirometer shows exponential growth and therefore exponential oxygen
use. Typically this method would be applied only after this exponential
relationship had been established using pilot experiments of empty
control experiments of sufficient duration, which is a practice we would
strongly recommend.</p>
<p>The <code>background_exp.rd</code> example dataset shows background
data with a rate that increases exponentially.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">background_exp.rd</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-57-1.png" width="960" style="display: block; margin: auto;"></p>
<p>We can see this is exponential from the rolling rate plot: the rate
is not constant, because that would be indicated by a horizontal level
line. It increases, however this is not a linear increase because it is
not increasing monotonically. Instead the increase accelerates with
time, that is increases exponentially.</p>
<div class="section level3">
<h3 id="adjust-rate-2">Adjust rate<a class="anchor" aria-label="anchor" href="#adjust-rate-2"></a>
</h3>
<p>We will use the same example as <a href="#lineareg1">above</a>, but
this time assume an exponential increase in background rate.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">rate</span>,</span>
<span>                        by <span class="op">=</span> <span class="va">bg_pre</span>,</span>
<span>                        by2 <span class="op">=</span> <span class="va">bg_post</span>,</span>
<span>                        method <span class="op">=</span> <span class="st">"exponential"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rate_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # summary.adjust_rate # -----------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using 'exponential' method.</span></span>
<span><span class="co">#&gt; Summary of all rate results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    rep rank intercept_b0 slope_b1   rsq density row endrow  time endtime  oxy endoxy     rate adjustment rate.adjusted</span></span>
<span><span class="co">#&gt; 1:  NA    1         81.0 -0.00191 0.909    1264 218    398 38517   38697 7.28   6.98 -0.00191 -0.0000942      -0.00182</span></span>
<span><span class="co">#&gt; 2:  NA    2         90.8 -0.00217 0.978     967   4    375 38303   38674 7.80   6.97 -0.00217 -0.0000941      -0.00207</span></span>
<span><span class="co">#&gt; 3:  NA    3        119.6 -0.00292 0.823     421  47    132 38346   38431 7.69   7.46 -0.00292 -0.0000941      -0.00282</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Under an exponential vs. a linear background relationship we would
expect the background rate to be lower at all stages of an experiment
except the very end. Here, as expected we see slightly lower adjustment
values than in the linear example <a href="#lineareg2">above</a>.</p>
</div>
<div class="section level3">
<h3 id="exponential-vs-linear-background">Exponential vs linear background<a class="anchor" aria-label="anchor" href="#exponential-vs-linear-background"></a>
</h3>
<p>In most experiments, the differences to final adjusted rates between
applying these two adjustment methods will be minor. The important
factor is to run trials to establish what kind of relationship the
background rate has over time, and try to minimise background as much as
possible.</p>
</div>
</div>
<div class="section level2">
<h2 id="case-9-adjusting-oxygen-production-rates">Case 9: Adjusting oxygen production rates<a class="anchor" aria-label="anchor" href="#case-9-adjusting-oxygen-production-rates"></a>
</h2>
<p><em>“We have oxygen production data from a seaweed and want to adjust
rates for oxygen consumption by microbial organisms in the
respirometer”</em></p>
<p>All of the above methods of adjustment will also work on oxygen
production data. The only thing to be wary of, as noted many times in
this vignette, is to be careful regarding the <em>signs</em> of the
rates involved. Oxygen consumption or removal rates are negative, oxygen
production or input rates positive.</p>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<p>The <code>algae.rd</code> dataset contains a recording from a
respirometry experiment on algae exposed to light, and so producing
oxygen via photosynthesis. We’ll calculate a production rate from these
data.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alg_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span><span class="va">algae.rd</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-59-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">alg_rt</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate # ---------------------</span></span>
<span><span class="co">#&gt; Rank 1 of 1 rates:</span></span>
<span><span class="co">#&gt; Rate: 0.0887 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note how the rate is positive, unlike all the other examples before
now.</p>
<p>A blank control experiment has also been conducted over the same time
period, so we’ll calculate a background rate.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bg_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="va">alg_bg</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-62-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bg_rt</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate.bg # ------------------</span></span>
<span><span class="co">#&gt; Background rate(s):</span></span>
<span><span class="co">#&gt; [1] -0.0145</span></span>
<span><span class="co">#&gt; Mean background rate:</span></span>
<span><span class="co">#&gt; [1] -0.0145</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>Note, this rate is negative. This suggests the production rate of the
specimen is being underestimated, because the microbial community in the
respirometer is consuming some of the produced oxygen. We can adjust the
rate to see.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">alg_rt</span>, <span class="va">bg_rt</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rt_adj</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : 0.0887</span></span>
<span><span class="co">#&gt; Adjustment    : -0.0145</span></span>
<span><span class="co">#&gt; Adjusted Rate : 0.103 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>We see this is indeed the case, and the adjusted rate is higher. We
can do this same adjustment using numeric values, but we must be careful
to use the correct signs.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="fl">0.0887</span>, <span class="op">-</span><span class="fl">0.0145</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : 0.0887</span></span>
<span><span class="co">#&gt; Adjustment    : -0.0145</span></span>
<span><span class="co">#&gt; Adjusted Rate : 0.103 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="case-10-oxygen-input-adjustments">Case 10: Oxygen input adjustments<a class="anchor" aria-label="anchor" href="#case-10-oxygen-input-adjustments"></a>
</h2>
<p><em>“Our respirometer is open to the air. We want to correct oxygen
uptake rates for oxygen <strong>input</strong> at the surface”</em></p>
<p>It is not just the rate to be adjusted that might be positive. There
are scenarios and experiments where the background change in oxygen is
an input, for example in open tank respirometry where the surface is
open to the atmosphere and the input of new oxygen has been quantified
or can be reliably estimated, such as by using Fick’s Law (e.g. <a href="https://januarharianto.github.io/respR/articles/refs.html#references">Leclercq
et al. 1999</a>).</p>
<p><code>adjust_rate</code> can therefore accept positive background
rate values.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.0176</span>, <span class="fl">0.0042</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0176</span></span>
<span><span class="co">#&gt; Adjustment    : 0.0042</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0218 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="case-11-manual-subtraction-of-background-differences">Case 11: Manual subtraction of background differences<a class="anchor" aria-label="anchor" href="#case-11-manual-subtraction-of-background-differences"></a>
</h2>
<p><em>“We want to manually adjust recorded oxygen values from the
specimen by the decrease observed in the control chamber”</em></p>
<p>There is one other way of using background data to adjust specimen
data, but it is a relatively simple arithmetic operation, and does not
require <code>adjust_rate</code>.</p>
<p>With a specimen chamber and a concurrent blank control, an
investigator may opt to calculate the difference in oxygen in the
control recordings from a set value, such as the initial oxygen
concentration, and then subtract this from the recorded values in the
specimen chamber. The rationale behind this is that any difference in
oxygen in the control from the initial conditions due to background use
is also occurring in the specimen chamber, so it is a simple arithmetic
operation to subtract this.</p>
<p>Here we’ll demonstrate this returns an equivalent result as the more
typical adjustment methods we show above. We’ll use the
<code>urchins.rd</code> data, specifically the first specimen column
(<code>2</code>) and first background column (<code>18</code>).</p>
<div class="section level3">
<h3 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>We’ll inspect both to see the structure.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-68-1.png" width="960" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">urchins.rd</span>, <span class="fl">1</span>, <span class="fl">18</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-68-2.png" width="960" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="subtraction-method">Subtraction method<a class="anchor" aria-label="anchor" href="#subtraction-method"></a>
</h3>
<p>First we’ll calculate the difference for every value in the
background oxygen data from the initial value. Then we subtract this
from the oxygen values in the specimen data. Finally we’ll calculate a
rate from the new data between 10 minutes and 30 minutes.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## background difference in oxygen from initial value</span></span>
<span><span class="va">bg_diff</span> <span class="op">&lt;-</span> <span class="va">urchins.rd</span><span class="op">[[</span><span class="fl">18</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">urchins.rd</span><span class="op">[[</span><span class="fl">18</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## make new dataframe of specimen data</span></span>
<span><span class="va">urch</span> <span class="op">&lt;-</span> <span class="va">urchins.rd</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## subtract background difference from specimen oxygen</span></span>
<span><span class="va">urch</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">urch</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">bg_diff</span></span>
<span></span>
<span><span class="co">## calculate rate</span></span>
<span><span class="va">urch_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span><span class="va">urch</span>, <span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.calc_rate # ---------------------</span></span>
<span><span class="co">#&gt; Rank 1 of 1 rates:</span></span>
<span><span class="co">#&gt; Rate: -0.0277 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adjust_rate-method">adjust_rate method<a class="anchor" aria-label="anchor" href="#adjust_rate-method"></a>
</h3>
<p>Now we do the adjustment from the same data region using
<code>respR</code> functions.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## calculate urchin rate</span></span>
<span><span class="va">urch_rt</span> <span class="op">&lt;-</span> <span class="va">urchins.rd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## calculate background rate from same region</span></span>
<span><span class="va">bg_rt</span> <span class="op">&lt;-</span> <span class="va">urchins.rd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## adjust rate</span></span>
<span><span class="va">urch_rt_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="va">urch_rt</span>, <span class="va">bg_rt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.0286</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000912</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.0277 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre>
<p>We can see the final adjusted rate result is identical. Either of
these methods works, and is a valid way of adjusting specimen data for
background.</p>
</div>
</div>
<div class="section level2">
<h2 id="notes-and-tips">Notes and tips<a class="anchor" aria-label="anchor" href="#notes-and-tips"></a>
</h2>
<p>These are general notes and tips about using
<code>adjust_rate</code>.</p>
<div class="section level3">
<h3 id="using-only-part-of-a-background-recording">Using only part of a background recording<a class="anchor" aria-label="anchor" href="#using-only-part-of-a-background-recording"></a>
</h3>
<p><em>“We want to only use a part of a background recording to adjust
our specimen rate”</em></p>
<p>You may notice <code>calc_rate.bg</code> does not have region
selection inputs in the way <code>calc_rate</code> does. It calculates
the rate across the whole oxygen~time dataset as entered. This might
cause problems when you don’t want to use all of the background data,
there is a data anomaly at the start or end, or it is only part of a
larger dataset, such as when it has been conducted in the same chamber
as the specimen prior to it being inserted, and so is part of the same
data recording. In general, R makes it easy to subset datasets to
separate objects, however <code>respR</code> has a dedicated function to
do this for respirometry data: <code><a href="../reference/subset_data.html">subset_data()</a></code>.</p>
<p>Here, we have a background recording, but the chamber was left open
until the researcher was ready to start the experiment proper at around
timepoint 5000, so the initial stages are not useful.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">bg_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-74-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Using this complete dataset would give an incorrect background rate
estimation. Instead we use <code>subset_data</code> to subset only the
data region we are interested in and pass it to
<code>calc_rate.bg</code>. This subsetting can be performed using
<code>"time"</code>, <code>"row"</code>, or <code>"oxygen"</code>
ranges.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_data.html">subset_data</a></span><span class="op">(</span><span class="va">bg_data</span>, from <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.bg.html">calc_rate.bg</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="adjust_rate_files/figure-html/unnamed-chunk-75-1.png" width="960" style="display: block; margin: auto;"></p>
<p>We can use the fact that the default is <code>method = "time"</code>
to subset from timepoint 5000. If we don’t specify a <code>to</code>
input the default behaviour is to subset to the end of the dataset.</p>
<p>Now we can use this background rate to adjust a specimen rate.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sard</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/inspect.html">inspect</a></span><span class="op">(</span><span class="va">sardine.rd</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/calc_rate.html">calc_rate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">2000</span>, to <span class="op">=</span> <span class="fl">4000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span>by <span class="op">=</span> <span class="va">bg</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sard</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # print.adjust_rate # -------------------</span></span>
<span><span class="co">#&gt; NOTE: Consider the sign of the adjustment value when adjusting the rate.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adjustment was applied using the 'mean' method.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Rank 1 of 1 adjusted rate(s):</span></span>
<span><span class="co">#&gt; Rate          : -0.000705</span></span>
<span><span class="co">#&gt; Adjustment    : -0.000115</span></span>
<span><span class="co">#&gt; Adjusted Rate : -0.000591 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see full results use summary().</span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>If you just want to extract a single rate, using
<code>calc_rate</code> and its region selection inputs to calculate a
background rate from a specific region is also an option. See <a href="#crbgvcr">here</a> for discussion about the main differences
between <code>calc_rate.bg</code> and <code>calc_rate</code>.</p>
</div>
<div class="section level3">
<h3 id="inform-how-long-experiments-should-be">Inform how long experiments should be<a class="anchor" aria-label="anchor" href="#inform-how-long-experiments-should-be"></a>
</h3>
<p><code>adjust_rate</code> allows you to estimate an appropriate or
maximum length an experiment should be. The higher the background rate,
the more uncertainty is introduced into estimations of the specimen
rate. After quantifying background and its increase over time, we can
estimate how long it will take until it reaches a certain percentage of
the specimen rates.</p>
<p>For example, let’s take the <a href="#lineareg2">example from
above</a> of the linearly increasing background rate of our zebrafish,
and decide background rates above 10% of specimen rates are unacceptably
high. We can estimate how long it will take for this to occur.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duration</span> <span class="op">&lt;-</span> <span class="fl">70000</span> <span class="co"># starting duration</span></span>
<span><span class="va">under10</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># This will hold our logical test result</span></span>
<span></span>
<span><span class="co"># Is the background rate under 10% of the specimen rate?</span></span>
<span><span class="co"># while it is, repeat, adding 1 hour to duration each time </span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="va">under10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">rate_adj</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/adjust_rate.html">adjust_rate</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.00191</span>, <span class="co"># typical specimen rate</span></span>
<span>                    by <span class="op">=</span> <span class="op">-</span><span class="fl">0.0000742</span>, <span class="co"># initial background rate</span></span>
<span>                    by2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.0001217</span>, <span class="co"># end background rate</span></span>
<span>                    time_x <span class="op">=</span> <span class="va">duration</span>, <span class="co"># this is what we vary</span></span>
<span>                    time_by <span class="op">=</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">4999</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, <span class="co"># initial background time</span></span>
<span>                    time_by2 <span class="op">=</span> <span class="op">(</span><span class="fl">75140</span> <span class="op">+</span> <span class="fl">79251</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>, <span class="co"># end background time</span></span>
<span>                    method <span class="op">=</span> <span class="st">"linear"</span><span class="op">)</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Is background rate under 10% of specimen rate?</span></span>
<span>  <span class="va">under10</span> <span class="op">&lt;-</span> <span class="va">rate_adj</span><span class="op">$</span><span class="va">adjustment</span><span class="op">/</span><span class="va">rate_adj</span><span class="op">$</span><span class="va">rate</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">&lt;</span> <span class="fl">10</span></span>
<span>  <span class="co"># Increase duration by 1 hour</span></span>
<span>  <span class="va">duration</span> <span class="op">&lt;-</span> <span class="va">duration</span> <span class="op">+</span> <span class="fl">3600</span></span>
<span>  <span class="co"># if bg NOT under 10% of specimen rate print the duration in hours</span></span>
<span>  <span class="co"># The while loop will also stop here</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">under10</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">duration</span><span class="op">/</span><span class="fl">60</span><span class="op">/</span><span class="fl">60</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] 53.4</span></span></code></pre></div>
<p>Now we can see this level of background rate will be reached in
around 53 hours, so our current experiments of 24h are well within this.
If we wanted to run them even longer however, this gives us a good idea
of the maximum duration before the background rate might interfere with
good estimates of specimen rate.</p>
</div>
<div class="section level3">
<h3 id="s3-generics">S3 generics<a class="anchor" aria-label="anchor" href="#s3-generics"></a>
</h3>
<p>As with most outputs in <code>respR</code>, <code>adjust_rate</code>
objects support the generic S3 functions <code>print</code>,
<code>summary</code>, and <code>mean</code>. These have the additional
inputs <code>pos</code> and <code>export</code>. See help files for
additional information. In the case of <code>mean</code>, if there are
multiple rates they return the mean value of the primary output
<code>$rate.adjusted</code>. This can be output as a value by passing
<code>export = TRUE</code>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicholas Carey, Januar Harianto.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
