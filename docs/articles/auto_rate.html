<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automatic detection of respirometry parameters • respR</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic detection of respirometry parameters">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">respR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/respR.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/auto_rate.html">Automatic detection of respirometry parameters</a>
    </li>
    <li>
      <a href="../articles/flowthrough.html">Flowthrough respirometry</a>
    </li>
    <li>
      <a href="../articles/intermittent.html">Analysis of intermittent-flow data</a>
    </li>
    <li>
      <a href="../articles/pcrit.html">Determining Pcrit</a>
    </li>
    <li>
      <a href="../articles/performance.html">Assessing the performance of respR's auto_rate function in detecting linear data</a>
    </li>
    <li>
      <a href="../articles/twopoint.html">Two-point analyses</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/januarharianto/respr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="auto_rate_files/htmlwidgets-1.0/htmlwidgets.js"></script><script src="auto_rate_files/viz-0.3/viz.js"></script><link href="auto_rate_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="auto_rate_files/grViz-binding-1.0.0/grViz.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Automatic detection of respirometry parameters</h1>
            
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In respirometry, we often want to report oxygen uptake rates that represent experimentally important stages or physiological states. These include:</p>
<ul>
<li>minimum rates observed, often most representative of resting or maintenance metabolism;</li>
<li>maximum rates observed, representative of active or maximal metabolic rates; and<br>
</li>
<li>the most consistent rates observed, often most representative of standard metabolic rates.</li>
</ul>
<p>Here were present <code><a href="../reference/auto_rate.html">auto_rate()</a></code>, a function in the <code>respR</code> package that uses rolling regression techniques to automatically estimate the estimate the most linear rates over a specific sampling window. In addition, it identifies maximum, minimum, and interval rates. When used to detect linear sections of the data, a kernel density estimate is performed on the rolling regression output and the kernel bandwidth used to re-sample linear regions of the data for re-analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>urchins.rd[,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">15</span>)]
<span class="kw"><a href="../reference/auto_rate.html">auto_rate</a></span>(x)
<span class="co">#&gt; 10 kernel density peaks detected and ranked.</span></code></pre></div>
<p><img src="auto_rate_files/figure-html/unnamed-chunk-1-1.png" width="681.6"></p>
<p>The diagram below illustrates the main processes involved in producing the different outputs of the function:</p>
<div id="htmlwidget-b1ac5174771139ad5757" style="width:681.6px;height:576px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-b1ac5174771139ad5757">{"x":{"diagram":"\ndigraph a_nice_graph {\n\n# node definitions with substituted label text\n\nnode [fontname = Helvetica, shape = circle]\nrd [label = \"Raw Data\"]\n\nnode [fontname = Helvetica, shape = rectangle]\nrr [label = \"1. Rolling linear regression\"]\nkd [label = \"2. Kernel density\nestimates\"]\nre [label = \"3. Bandwidth resampling\"]\nlr [label = \"4. Linear regression\"]\nar [label = \"5. Rank\"]\nfi [label = \"6. Filter\"]\n\nnode [fontname = Menlo, shape = none]\nau [label = \"auto_rate()\"]\nli [label = \"linear\"]\nmm [label = \"max, min\"]\nin [label = \"interval\"]\n\n# edge definitions with the node IDs\n\nrd -> au -> rr -> ar -> mm\nrr -> kd -> re -> lr -> ar -> li\nrr -> fi -> in\n\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><!-- ### Working in the Tidyverse --><!-- `respR` integrates nicely in the [Tidyverse](https://www.tidyverse.org/), specifically with `dplyr` functions e.g. `select()`, `filter()` and `mutate()`, and `magrittr` pipe operators ("`%>%`") to clearly express workflows in an organised sequence. For more information about using pipes in particular, see the ["Pipes" chapter](http://r4ds.had.co.nz/pipes.html) in the online R for Data Science book. --><!-- We load the data, `sardine.rd`, which contains approximately 2.1 hours (7,513 data points) of a single respirometry experiment. --><!-- ```{r} --><!-- library(respR) --><!-- data("sardine.rd") --><!-- ?sardine.rd # run this to see notes about the dataset --><!-- ``` -->
</div>
<div id="rolling-linear-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#rolling-linear-regression" class="anchor"></a>Rolling linear regression</h2>
<p>The function <code><a href="../reference/auto_rate.html">auto_rate()</a></code> uses a novel method of combining rolling regression and kernel density estimate algorithms to detect patterns in respirometry data. First, <code><a href="../reference/auto_rate.html">auto_rate()</a></code> always performs a rolling linear regression on the data before additional methods are applied. The rolling regression runs all possible ordinary least-squares (OLS) linear regressions <span class="math inline">\((y = \beta_0 + \beta_1 X + \epsilon)\)</span> of a fixed sample width across the entire data series, and is expressed as: <span class="math display">\[y_t(n) = X_t(n) \beta (n) + \epsilon_t(n), \ t = n,\ ...,\ T\]</span> where <span class="math inline">\(n\)</span> is the window of width <span class="math inline">\(n &lt; T\)</span>, <span class="math inline">\(T\)</span> is the total length of the dataset, <span class="math inline">\(y_t(n)\)</span> is the vector of observations (e.g. oxygen concentration), <span class="math inline">\(X_t(n)\)</span> is the matrix of explanatory variables, <span class="math inline">\(\beta (n)\)</span> is a vector of regression parameters and <span class="math inline">\(\epsilon_t(n)\)</span> is a vector of error terms. Thus, a total of <span class="math inline">\((T - n) + 1\)</span> number of overlapping regressions are fitted, which are then ranked to obtain maximum and minimum values. If an interval-based regression is required, we select the <code>"interval"</code> method when calling the function, and it automatically selects non-overlapping sections of the data for regressions.</p>
</div>
<div id="kernel-density-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#kernel-density-estimation" class="anchor"></a>Kernel density estimation</h2>
<!-- Additional methods are automatically applied when we use `auto_rate()` to detect linear sections of the data.  -->
<!-- First, a Gaussian kernel density estimate (KDE) is used to process the regression coefficient $\beta$, based on the key assumption that linear sections of the data are reflected by relatively stable parameters across the rolling estimates. -->
<!-- This assumption is used often in financial statistics to evaluate stability and make predictions on time-series data. -->
<!-- Here, KDE automatically aggregates stable (i.e. linear) sections as they naturally form one or more local maximums ("modes") in the probability density estimate, and if the distribution is multimodal, the modes are ranked by size. -->
<p>Additional analytical techniques are automatically applied when we use <code><a href="../reference/auto_rate.html">auto_rate()</a></code> to detect linear sections of the data. First, we take advantage of the key assumption that linear sections of a data series are reflected by stable parameters across the rolling estimates, a property that is often applied in financial statistics to evaluate model stability and make forward predictions on time-series data (see Zivot and Wang 2006). We use kernel density estimation (KDE) techniques, often applied in various inference procedures such as machine learning, pattern recognition and computer vision, to automatically aggregate stable (i.e. linear) segments as they naturally form one or more local maximums (“modes”) in the probability density estimate.</p>
<p>KDE requires no assumption that the data is from a parametric family, and learns the shape of the density automatically without supervision. KDE can be expressed as: <span class="math display">\[\hat{f}(x) = \frac{1}{nh^d}\sum_{i = 1}^{n} K \left(\frac{x - X_i}{h} \right)\]</span> where <span class="math inline">\(f\)</span> is the density function from an unknown distribution <span class="math inline">\(P\)</span> for <span class="math inline">\(X_1,...,X_n\)</span>, <span class="math inline">\(K\)</span> is the kernel function and <span class="math inline">\(h\)</span> is the optimal smoothing bandwidth. The smoothing bandwidth is computed using the solve-the-equation <em>plug-in</em> method (Sheather et al. 1996, Sheather and Jones 1991) which works well with multimodal or non-normal densities (Raykar and Duraiswami 2006).</p>
<!-- The smoothing bandwidth $h$ is computed using an adjusted kernel bandwidth selector based on Silvermans "rule of thumb" (Silverman, 1986): $$h = \left(\frac{4\hat{\sigma}^5}{3n} \right)^{\frac{1}{5}} \approx 1.06\hat{\sigma}n^{-\frac{1}{5}}$$ where $\hat{\sigma}$ is the standard deviation of the samples and $n$ is the total number of samples.  -->
<p>We then use <span class="math inline">\(h\)</span> to select all values in the rolling regression output that match the range of values around each mode (<span class="math inline">\(\theta_n\)</span>) of the KDE (i.e. <span class="math inline">\(\theta_n \pm h\)</span>). These rolling estimates are grouped and the upper and lower bounds of the data windows they represent are used to re-select the linear segment of the original data series. The rolling estimates are discarded, while the newly detected data segments are analysed using linear regression.</p>
</div>
<div id="adjusting-the-width-of-rolling-regressions" class="section level2">
<h2 class="hasAnchor">
<a href="#adjusting-the-width-of-rolling-regressions" class="anchor"></a>Adjusting the width of rolling regressions</h2>
<p>By default, <code><a href="../reference/auto_rate.html">auto_rate()</a></code>’s rolling regression uses a rolling window value of <code>0.2</code> multiplied by the total length of the number of samples, or total time elapsed. This can be changed by changing the <code>width</code> argument, to a proportion relative to the total size of the data (<code>width = 0.1</code>) or a fixed number (<code>width = 3000</code>).</p>
<p>It is important to note that the width determines the exact width of the data segments produced for <code>max</code>, <code>min</code> and <code>interva</code>l rates. This allows the user to consitently report results across experiments, such as reporting the maximum or minimum rates sustained over a specified time period.</p>
<p>Importantly, the <code>width</code> does <em>not</em> restrict the maximum width of the segments produced for linear detection. <strong>We advise users to use caution when changing the <code>width</code> argument if using <code>method = "linear"</code>.</strong> Choosing an inappropriate width value tends to over-fit the data for rolling regression.</p>
<p>Below, we show the differences in the shape of the rolling regressions when using a <code>width</code> of <code>0.6</code> to analyse <code>sardine.rd</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Perform linear detection; default width (when not specified) is 0.2:</span>
normx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auto_rate.html">auto_rate</a></span>(sardine.rd, <span class="dt">plot =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; 46 kernel density peaks detected and ranked.</span>

<span class="co"># Perform linear detection using manual width of 0.6:</span>
overx &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auto_rate.html">auto_rate</a></span>(sardine.rd, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">width =</span> .<span class="dv">6</span>)
<span class="co">#&gt; 19 kernel density peaks detected and ranked.</span>

<span class="co"># Plot ONLY the rolling regression plots for comparison:</span>
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">mai =</span> <span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span>), <span class="dt">ps =</span> <span class="dv">10</span>,
    <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">cex.main =</span> <span class="dv">1</span>)
<span class="kw">plot</span>(normx, <span class="dt">choose =</span> <span class="dv">3</span>)
<span class="kw">plot</span>(overx, <span class="dt">choose =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="auto_rate_files/figure-html/rollreg_demo-1.png" width="681.6"></p>
<p>Under perfectly linear conditions, we would expect the rolling regression output to produce a straight, horizontal line with a slope of 0, i.e. a very stable plot. Since KDE automatically aggregates stable values, a poor selection of the <code>width</code> value may result in a badly-characterised rolling estimate output. In the example presented above, while the default width showed a pattern of relative stability after 3,000 seconds, that information was lost when a <code>width</code> of <code>0.6</code> was used. Thus, the KDE technique would not have had the appropriate information necessary to correctly detect any linear patterns in the same data.</p>
<!-- ## Examples -->
<!-- Usage examples for `auto_rate()` can be found by invoking `?auto_rate` in the R console. -->
<!-- ### Detecting and measuring maxiumum/minimum rate -->
<!-- Detecting the maximum or minimum rate using a specific width constraint produces results that are comparable between different measurements.  -->
<!-- Here we use the `width` argument to ensure that the length of the detected region is fixed at 10 minutes, or 600 seconds: -->
<!-- ```{r} -->
<!-- auto_rate(sardine.rd, width = 600, method = "max") -->
<!-- ``` -->
<!-- The maximum rate is returned by default, but we can easily obtain the minimum value by picking the lowest ranked result: -->
<!-- ```{r} -->
<!-- x <- auto_rate(sardine.rd, width = 600, method = "max") -->
<!-- print(x, nrow(x$summary)) -->
<!-- ``` -->
<!-- The above result is identical to using `auto_rate()` while calling the argument `method = "min"`: -->
<!-- ```{r} -->
<!-- auto_rate(sardine.rd, width = 600, method = "min") -->
<!-- ``` -->
<!-- ### Interval rate -->
<!-- ```{r} -->
<!-- x <- auto_rate(sardine.rd, width = 1000, method = "interval") -->
<!-- print(x, 4)  # select the 4th interval result -->
<!-- ``` -->
<!-- ### Detecting and measuring linear regions -->
<!-- The function `auto_rate()` performs automatic detection of linear data by default: -->
<!-- ```{r} -->
<!-- x <- auto_rate(sardine.rd) -->
<!-- ``` -->
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>Examples are available in the <a href="https://januarharianto.github.io/respR/reference/index.html">reference section</a>. You may also run <code><a href="../reference/auto_rate.html">?auto_rate</a></code> in the R console to access some examples in the help file.</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Jones, M. C., Marron, J. S., &amp; Sheather, S. J. (1996). A Brief Survey of Bandwidth Selection for Density Estimation. Journal of the American Statistical Association, 91(433), 401–407. <a href="doi:10.1080/01621459.1996.10476701" class="uri">doi:10.1080/01621459.1996.10476701</a></p>
<p>Olito, C., White, C. R., Marshall, D. J., &amp; Barneche, D. R. (2017). Estimating monotonic rates from biological data using local linear regression. The Journal of Experimental Biology, jeb.148775-jeb.148775. <a href="doi:10.1242/jeb.148775" class="uri">doi:10.1242/jeb.148775</a></p>
<p>Raykar, V., &amp; Duraiswami, R. (2006). Fast optimal bandwidth selection for kernel density estimation. In Proceedings of the Sixth SIAM International Conference on Data Mining (Vol. 2006). <a href="doi:10.1137/1.9781611972764.53" class="uri">doi:10.1137/1.9781611972764.53</a></p>
<p>Sheather, S. J., &amp; Jones, M. C. (1991). A Reliable Data-Based Bandwidth Selection Method for Kernel Density Estimation. Journal of the Royal Statistical Society. Series B (Methodological), 53(3), 683–690.</p>
<p>Zivot, E., &amp; Wang, J. (2006). Modeling Financial Time Series with S-PLUS (2nd ed.). New York: Springer-Verlag.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#rolling-linear-regression">Rolling linear regression</a></li>
      <li><a href="#kernel-density-estimation">Kernel density estimation</a></li>
      <li><a href="#adjusting-the-width-of-rolling-regressions">Adjusting the width of rolling regressions</a></li>
      <li><a href="#examples">Examples</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Januar Harianto, Nicholas Carey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
